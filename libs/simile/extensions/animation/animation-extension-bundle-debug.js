

/* animation-facet.js */
Exhibit.AnimationFacet=function(containerElmt,uiContext){this._div=containerElmt;
this._uiContext=uiContext;
this._expression=null;
this._mode=Exhibit.AnimationFacet.MODE_NONE;
this._listModePeriods=null;
this._listModeCurrentPeriods=[];
this._rangeModePrecision=null;
this._rangeModeMaxRange={min:null,max:null};
this._rangeModeCurrentRange={min:null,max:null};
this._dateModeInterval=null;
this._settings={};
this._ui=null;
};
Exhibit.AnimationFacet.DAY="day";
Exhibit.AnimationFacet.MONTH="month";
Exhibit.AnimationFacet.YEAR="year";
Exhibit.AnimationFacet.MODE_NONE=0;
Exhibit.AnimationFacet.MODE_LIST=1;
Exhibit.AnimationFacet.MODE_RANGE=2;
Exhibit.AnimationFacet.MODE_DATE=3;
Exhibit.AnimationFacet.DEBUG1=false;
Exhibit.AnimationFacet.PLAY_PNG="iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wDGw42NiWo9VwAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAADtJREFUKM+VjzEKACAAAu+i/3+5lpYgQgU3DxVgHUfyEbYFvqDBHFvgAhsAgEGpWWRNAdMG00mmH0yObCp4Bx5kUSOtAAAAAElFTkSuQmCC";
Exhibit.AnimationFacet.PAUSE_PNG="iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wDGw43G3lsmGgAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAB1JREFUKM9jZGBg+M+ACRihNIYcEwOJYFTDSNEAAI/YAhcjCBZEAAAAAElFTkSuQmCC";
Exhibit.AnimationFacet._getNextAnimationUnique=function(){if(!Exhibit.AnimationFacet._animationCounter){Exhibit.AnimationFacet._animationCounter=0;
}var r=Exhibit.AnimationFacet._animationCounter;
Exhibit.AnimationFacet._animationCounter++;
return r;
};
Exhibit.AnimationFacet._settingSpecs={"facetLabel":{type:"text"},"showLabel":{type:"boolean",defaultValue:true},"type":{type:"text",defaultValue:"default"},"width":{type:"text"},"height":{type:"text"},"formatter":{type:"text",defaultValue:null},"startTime":{type:"int",defaultValue:0},"duration":{type:"int",defaultValue:60}};
Exhibit.AnimationFacet.create=function(configuration,containerElmt,uiContext){if(Exhibit.AnimationFacet.DEBUG1){console.log("create",configuration,containerElmt,uiContext);
}var uiContext=Exhibit.UIContext.create(configuration,uiContext);
var facet=new Exhibit.AnimationFacet(containerElmt,uiContext);
Exhibit.AnimationFacet._configure(facet,configuration);
facet._initializeUI();
uiContext.getCollection().addFacet(facet);
return facet;
};
Exhibit.AnimationFacet.createFromDOM=function(configElmt,containerElmt,uiContext){if(Exhibit.AnimationFacet.DEBUG1){console.log("createFromDOM",configElmt,containerElmt,uiContext);
}var uiContext=Exhibit.UIContext.createFromDOM(configElmt,uiContext);
var facet=new Exhibit.AnimationFacet(containerElmt!=null?containerElmt:configElmt,uiContext);
Exhibit.SettingsUtilities.collectSettingsFromDOM(configElmt,Exhibit.AnimationFacet._settingSpecs,facet._settings);
try{var expressionString=Exhibit.getAttribute(configElmt,"expression");
if(expressionString!=null&&expressionString.length>0){facet._expression=Exhibit.ExpressionParser.parse(expressionString);
}if(facet._expression==null){SimileAjax.Debug.exception(e2,"AnimationFacet: no expression specified; using .label");
facet._expression=".label";
}var selections=Exhibit.getAttribute(configElmt,"selections");
if(selections!=null&&selections.length>0){try{facet._listModePeriods=eval(selections);
facet._mode=Exhibit.AnimationFacet.MODE_LIST;
}catch(e2){SimileAjax.Debug.exception(e2,"AnimationFacet: Selections needs to be valid JSON structure");
}}else{try{var sequence=Exhibit.getAttribute(configElmt,"selectionSequence");
var dur=facet._settings.duration;
if(!dur){dur=60;
}if(sequence!=null&&sequence.length>0){var a=sequence.split(",");
var b=[];
var d=Math.floor(dur/a.length);
for(var i=0;
i<a.length;
i++){b.push({from:i*d,to:i*d+d,select:[$.trim(a[i])]});
}}facet._listModePeriods=b;
facet._mode=Exhibit.AnimationFacet.MODE_LIST;
}catch(e2){SimileAjax.Debug.exception(e2,"AnimationFacet: Selection sequence or duration is invalid");
}}var precision=Exhibit.getAttribute(configElmt,"precision");
if(precision!=null&&precision.length>0){try{facet._rangeModePrecision=parseInt(precision);
facet._mode=Exhibit.AnimationFacet.MODE_RANGE;
}catch(e2){SimileAjax.Debug.exception(e2,"AnimationFacet: Precision needs to be integer");
}}var datePrecision=Exhibit.getAttribute(configElmt,"datePrecision");
if(datePrecision!=null&&datePrecision.length>0){try{var arr=[Exhibit.AnimationFacet.DAY,Exhibit.AnimationFacet.MONTH,Exhibit.AnimationFacet.YEAR];
for(var i=0;
i<arr.length;
i++){if(datePrecision.toLowerCase()==arr[i]){facet._dateModeInterval=arr[i];
facet._mode=Exhibit.AnimationFacet.MODE_DATE;
}}}catch(e2){SimileAjax.Debug.exception(e2,"AnimationFacet: Date precision needs to be year, month or day");
}}if(facet._mode==Exhibit.AnimationFacet.MODE_NONE){SimileAjax.Debug.exception(e2,"AnimationFacet: need to define either ex:selections, ex:precision or ex:datePrecision");
}}catch(e){SimileAjax.Debug.exception(e,"AnimationFacet: Error processing configuration of animation facet");
}Exhibit.AnimationFacet._configure(facet);
facet._initializeUI();
uiContext.getCollection().addFacet(facet);
return facet;
};
Exhibit.AnimationFacet._configure=function(facet,configuration){if(Exhibit.AnimationFacet.DEBUG1){console.log("_configure",facet,configuration);
}if(!("facetLabel" in facet._settings)){facet._settings.facetLabel="Animation facet";
if(facet._expression!=null&&facet._expression.isPath()){var segment=facet._expression.getPath().getLastSegment();
var property=facet._uiContext.getDatabase().getProperty(segment.property);
if(property!=null){facet._settings.facetLabel=segment.forward?property.getLabel():property.getReverseLabel();
}}}if("formatter" in facet._settings){var formatter=facet._settings.formatter;
if(formatter!=null&&formatter.length>0){try{facet._formatter=eval(formatter);
}catch(e){SimileAjax.Debug.log(e);
}}}if(facet._mode==Exhibit.AnimationFacet.MODE_LIST){facet._cache=new Exhibit.FacetUtilities.Cache(facet._uiContext.getDatabase(),facet._uiContext.getCollection(),facet._expression);
}else{if(facet._mode==Exhibit.AnimationFacet.MODE_RANGE){var r;
var database=facet._uiContext.getDatabase();
if(facet._expression.getPath()){var path=facet._expression.getPath();
var propertyID=path.getLastSegment().property;
var property=database.getProperty(propertyID);
r=property.getRangeIndex();
}else{var expression=facet._expression;
r=new Exhibit.Database._RangeIndex(facet._uiContext.getCollection().getAllItems(),function(item,f){expression.evaluateOnItem(item,database).values.visit(function(value){if(typeof value!="number"){value=parseFloat(value);
}if(!isNaN(value)){f(value);
}});
});
}facet._rangeModeMaxRange={min:facet._minRangePrecision(r.getMin()),max:facet._maxRangePrecision(r.getMax())};
var database=facet._uiContext.getDatabase();
var getter=function(item,f){facet._expression.evaluateOnItem(item,database).values.visit(function(value){if(typeof value!="number"){value=parseFloat(value);
}if(!isNaN(value)){f(value);
}});
};
facet._rangeIndex=new Exhibit.Database._RangeIndex(facet._uiContext.getCollection().getAllItems(),getter);
}else{if(facet._mode==Exhibit.AnimationFacet.MODE_DATE){}}}};
Exhibit.AnimationFacet.prototype.dispose=function(){if(Exhibit.AnimationFacet.DEBUG1){console.log("dispose");
}this._ui.dispose();
if(this._cache){this._cache.dispose();
this._cache=null;
}if(this._rangeIndex){this._rangeIndex=null;
}this._uiContext.getCollection().removeFacet(this);
this._uiContext=null;
this._div.innerHTML="";
this._div=null;
this._expression=null;
this._settings=null;
this._listModePeriods=null;
this._listModeCurrentPeriods=null;
this._listModeValueSet=null;
this._rangeModeMaxRange=null;
this._rangeModeCurrentRange=null;
};
Exhibit.AnimationFacet.prototype.hasRestrictions=function(){if(Exhibit.AnimationFacet.DEBUG1){console.log("hasRestrictions");
}if(this._mode==Exhibit.AnimationFacet.MODE_LIST){return this._listModeCurrentPeriods.length>0;
}else{if(this._mode==Exhibit.AnimationFacet.MODE_RANGE){var min=(this._rangeModeCurrentRange.min!=null&&this._rangeModeCurrentRange.min!=this._rangeModeMaxRange.min);
var max=(this._rangeModeCurrentRange.max!=null&&this._rangeModeCurrentRange.max!=this._rangeModeMaxRange.max);
return(min||max);
}else{if(this._mode==Exhibit.AnimationFacet.MODE_DATE){return false;
}else{return false;
}}}};
Exhibit.AnimationFacet.prototype.restrict=function(items){if(Exhibit.AnimationFacet.DEBUG1){console.log("restrict",items);
}if(this._mode==Exhibit.AnimationFacet.MODE_LIST){if(this._listModeCurrentPeriods.length==0){return items;
}else{var valueSet=new Exhibit.Set();
for(var i=0;
i<this._listModeCurrentPeriods.length;
i++){var p=this._listModeCurrentPeriods[i];
for(var j=0;
j<p.select.length;
j++){valueSet.add(p.select[j]);
}}return this._cache.getItemsFromValues(valueSet,items);
}}else{if(this._mode==Exhibit.AnimationFacet.MODE_RANGE){var min=this._rangeModeCurrentRange.min;
var max=this._rangeModeCurrentRange.max;
if(this._expression.isPath()){var path=this._expression.getPath();
var database=this._uiContext.getDatabase();
return path.rangeBackward(min,max,false,items,database).values;
}else{return this._rangeIndex.getSubjectsInRange(min,max,false,null,items);
}}else{if(this._mode==Exhibit.AnimationFacet.MODE_DATE){}}}};
Exhibit.AnimationFacet.prototype.clearAllRestrictions=function(){if(Exhibit.AnimationFacet.DEBUG1){console.log("clearAllRestrictions");
}Exhibit.AnimationFacet.testRemoteLog();
if(this.hasRestrictions()){if(this._mode==Exhibit.AnimationFacet.MODE_LIST){this._listModeCurrentPeriods=[];
}else{if(this._mode==Exhibit.AnimationFacet.MODE_RANGE){this._rangeModeCurrentRange.min=this._rangeModeMaxRange.min;
this._rangeModeCurrentRange.max=this._rangeModeMaxRange.max;
}}var preUpdateSize=SimileAjax.RemoteLog.logActive?this._uiContext.getCollection().countRestrictedItems():0;
this._notifyCollection();
var postUpdateSize=SimileAjax.RemoteLog.logActive?this._uiContext.getCollection().countRestrictedItems():0;
var totalSize=SimileAjax.RemoteLog.logActive?this._uiContext.getCollection().countAllItems():0;
SimileAjax.RemoteLog.possiblyLog({facetType:"AnimationFacet",facetLabel:this._settings.facetLabel,operation:"clearAllRestrictions",exhibitSize:totalSize,preUpdateSize:preUpdateSize,postUpdateSize:postUpdateSize});
}};
Exhibit.AnimationFacet.prototype.applyRestrictions=function(restrictions){};
Exhibit.AnimationFacet.prototype.setSelection=function(value,selected){};
Exhibit.AnimationFacet.prototype.update=function(items){if(Exhibit.AnimationFacet.DEBUG1){console.log("update",items);
}};
Exhibit.AnimationFacet.prototype._notifyCollection=function(){if(Exhibit.AnimationFacet.DEBUG1){console.log("_notifyCollection");
}this._uiContext.getCollection().onFacetUpdated(this);
};
Exhibit.AnimationFacet.prototype._initializeUI=function(){if(Exhibit.AnimationFacet.DEBUG1){console.log("_initializeUI");
}switch(this._settings["type"]){case"youtube":this._ui=new Exhibit.AnimationFacet.YouTube(this);
break;
case"slideshare":this._ui=new Exhibit.AnimationFacet.SlideShare(this);
break;
case"inline":this._ui=new Exhibit.AnimationFacet.Inline(this);
break;
case"default":default:this._ui=new Exhibit.AnimationFacet.DefaultUI(this);
break;
}this._ui.setDuration(this._settings.duration);
var html=this._ui.initUI();
$(this._div).html(html);
this._ui.postInitUI();
};
Exhibit.AnimationFacet.prototype._clearSelections=function(){if(Exhibit.AnimationFacet.DEBUG1){console.log("_clearSelections");
}var state={};
var self=this;
SimileAjax.History.addLengthyAction(function(){state.restrictions=self.clearAllRestrictions();
},function(){self.applyRestrictions(state.restrictions);
},String.substitute(Exhibit.FacetUtilities.l10n["facetClearSelectionsActionTitle"],[this._settings.facetLabel]));
};
Exhibit.AnimationFacet.testRemoteLog=function(){if(!SimileAjax["RemoteLog"]){SimileAjax.RemoteLog={logActive:false};
SimileAjax.RemoteLog.possiblyLog=function(a){};
}};
Exhibit.AnimationFacet.prototype.updateModeParams=function(secs){if(this._mode==Exhibit.AnimationFacet.MODE_LIST){var periods=[];
for(var i=0;
i<this._listModePeriods.length;
i++){var p=this._listModePeriods[i];
if(secs>=p.from&&secs<p.to){periods.push(p);
}}var rebuild=false;
if(periods.length!=this._listModeCurrentPeriods.length){rebuild=true;
}else{for(var i=0;
i<this._listModeCurrentPeriods.length;
i++){if(periods[i]!=this._listModeCurrentPeriods[i]){rebuild=true;
break;
}}}if(rebuild){this._listModeCurrentPeriods=periods;
this._notifyCollection();
}}else{if(this._mode==Exhibit.AnimationFacet.MODE_RANGE){var rng=this._rangeModeMaxRange.max-this._rangeModeMaxRange.min;
var pos=secs/this._ui.getDuration();
var val=Math.floor(this._rangeModeMaxRange.min+rng*pos);
var min=this._minRangePrecision(val);
var max=this._maxRangePrecision(val);
if(this._rangeModeCurrentRange.min!=min||this._rangeModeCurrentRange.max!=max){this._rangeModeCurrentRange.min=min;
this._rangeModeCurrentRange.max=max;
this._notifyCollection();
}}else{if(this._mode==Exhibit.AnimationFacet.MODE_DATE){}}}};
Exhibit.AnimationFacet.prototype._minRangePrecision=function(v){var pr=this._rangeModePrecision;
v-=((v>=0)?v%pr:pr-Math.abs(v%pr));
return v;
};
Exhibit.AnimationFacet.prototype._maxRangePrecision=function(v){var pr=this._rangeModePrecision;
v+=((v>=0)?pr-v%pr:Math.abs(v%pr));
return v;
};
Exhibit.AnimationFacet.Labels=function(facet,secs,config){if(facet._mode==Exhibit.AnimationFacet.MODE_LIST){if(config==undefined){config={base:0,showAsSeconds:false,inclusiveBounds:false};
}var f=(config.showAsSeconds)?function(secs){return secs+config.base;
}:function(secs){var m=Math.floor(secs/60);
var s=Math.ceil(secs%60);
return m+":"+(s<10?"0":"")+s;
};
this.timeLabel=f(secs);
this.lowerLabel=f(0);
this.upperLabel=f(facet._ui.getDuration()-(config.inclusiveBounds?1:0));
}else{if(facet._mode==Exhibit.AnimationFacet.MODE_RANGE){var rng=facet._rangeModeMaxRange.max-facet._rangeModeMaxRange.min;
var pos=secs/facet._ui.getDuration();
this.timeLabel=Math.floor(facet._rangeModeMaxRange.min+rng*pos);
this.lowerLabel=facet._rangeModeMaxRange.min;
this.upperLabel=facet._rangeModeMaxRange.max;
}else{this.timeLabel="?";
this.lowerLabel="Lower";
this.upperLabel="Upper";
}}};
Exhibit.AnimationFacet.DefaultUI=function(facet){this._duration=0;
this._dom=null;
this._facet=facet;
this._currentTimePosition=0;
this._animationStartTime=0;
this._animationStartPosition=0;
this._animationFrameDelay=100;
this._animationPlaying=false;
this._dragging=false;
this._animationGlueFunc="__animation_glue__"+Exhibit.AnimationFacet._getNextAnimationUnique();
var self=this;
Exhibit.AnimationFacet.DefaultUI[this._animationGlueFunc]=function(){self._animate();
};
};
Exhibit.AnimationFacet.DefaultUI.prototype.dispose=function(){this._dom=null;
};
Exhibit.AnimationFacet.DefaultUI.prototype.setDuration=function(secs){this._duration=secs;
};
Exhibit.AnimationFacet.DefaultUI.prototype.getDuration=function(){return this._duration;
};
Exhibit.AnimationFacet.DefaultUI.prototype.initUI=function(){var labels=new Exhibit.AnimationFacet.Labels(this._facet,0);
var settings=this._facet._settings;
var cssHeight=settings["height"]?" height:"+settings["height"]:"10px";
var html='<div><div class="exhibit-facet-header" style="position:Relative;"><span class="exhibit-facet-header-filterControl" style="position:Absolute; display:Inline-Block; vertical-align:Middle; right:0px; top:0px; text-align:Right; white-space:NoWrap;"><span class="exhibit-facet-animation-button"></span>&nbsp;<input type="checkbox" class="exhibit-facet-animation-tickbox" /></span>'+((settings["showLabel"])?'<span class="exhibit-facet-header-title">'+settings["facetLabel"]+"</span>":"")+'</div><div class="exhibit-facet-animation-shaft-container"><div class="exhibit-facet-animation-shaft" style="position:Relative; width:100%;'+cssHeight+'"><div class="exhibit-facet-animation-shaft-markers" style="'+cssHeight+'"></div><div class="exhibit-facet-animation-shaft-thumb" style="position:Absolute;'+cssHeight+'"></div></div></div><div class="exhibit-facet-animation-labels" style="position:Relative; height:1em;"><div style="position:Absolute; left:0px;">'+labels.lowerLabel+'</div><div style="position:Absolute; right:0px;">'+labels.upperLabel+'</div><div class="exhibit-facet-animation-labels-time" style="text-align:Center"></div></div></div>';
var el=$(html);
this._dom={elmt:el.get()[0],shaft:$(".exhibit-facet-animation-shaft",el).get()[0],thumb:$(".exhibit-facet-animation-shaft-thumb",el).get()[0],time:$(".exhibit-facet-animation-labels-time",el).get()[0],button:$(".exhibit-facet-animation-button",el).get()[0],tickbox:$("input.exhibit-facet-animation-tickbox",el).get()[0],markers:$(".exhibit-facet-animation-shaft-markers",el).get()[0]};
var self=this;
$(this._dom.shaft).mousedown(function(ev){if(ev.which==1){ev.preventDefault();
self._dragging=true;
}});
$(document).mousemove(function(ev){if(self._dragging&&ev.which==1){ev.preventDefault();
var x=ev.pageX-$(self._dom.shaft).offset().left;
self._updateThumbUI(x,false);
}}).mouseup(function(ev){if(self._dragging&&ev.which==1){ev.preventDefault();
var x=ev.pageX-$(self._dom.shaft).offset().left;
if(!self._updateThumbUI(x,true)){self._animationStartTime=(new Date()).getTime();
self._animationStartPosition=x;
}self._dragging=false;
}});
$(this._dom.tickbox).click(function(ev){var $this=$(this);
if($this.attr("checked")){self._facet.updateModeParams(self._currentTimePosition);
}else{self._facet.clearAllRestrictions();
}});
this._showPlayButton(true);
return this._dom.elmt;
};
Exhibit.AnimationFacet.DefaultUI.prototype.postInitUI=function(){this._updateThumbUI(0,false);
};
Exhibit.AnimationFacet.DefaultUI.prototype._showPlayButton=function(b){var self=this;
$(this._dom.button).html('<img src="data:image/png;base64,'+Exhibit.AnimationFacet[b?"PLAY_PNG":"PAUSE_PNG"]+'" />');
$("img",this._dom.button).click(b?function(ev){self._animateStart();
}:function(ev){self._animateStop();
});
$(this._dom.tickbox).attr("disabled",!b);
};
Exhibit.AnimationFacet.DefaultUI.prototype._updateThumbUI=function(x,considerRestrict){var w=$(this._dom.shaft).width();
var ended=(x>w-1);
x=(x<0)?0:x;
x=(x>w-1)?w-1:x;
var th=$(this._dom.thumb);
th.css("left",(x-th.width()/2)+"px");
this._currentTimePosition=Math.floor(this._duration*(x/w*1));
var labels=new Exhibit.AnimationFacet.Labels(this._facet,this._currentTimePosition);
$(this._dom.time).html(labels.timeLabel);
if(considerRestrict){this._facet.updateModeParams(this._currentTimePosition);
$(this._dom.tickbox).attr("checked",this._facet.hasRestrictions()?"checked":"");
}return ended;
};
Exhibit.AnimationFacet.DefaultUI.prototype._animateStart=function(){this._animationPlaying=true;
this._animationStartTime=(new Date()).getTime();
this._animationStartPosition=($(this._dom.thumb).offset().left)-($(this._dom.shaft).offset().left)+($(this._dom.thumb).width()/2);
this._showPlayButton(false);
setTimeout("Exhibit.AnimationFacet.DefaultUI."+this._animationGlueFunc+"()",this._animationFrameDelay);
};
Exhibit.AnimationFacet.DefaultUI.prototype._animateStop=function(){this._animationPlaying=false;
this._showPlayButton(true);
};
Exhibit.AnimationFacet.DefaultUI.prototype._animate=function(){var timeElapsed=(new Date()).getTime()-this._animationStartTime;
var sh_w=$(this._dom.shaft).width();
var pixelsPerMillisecond=sh_w/(this._duration*1000);
var distanceTravelled=timeElapsed*pixelsPerMillisecond;
var pos=this._animationStartPosition+distanceTravelled;
var ended=false;
if(!this._dragging){ended=this._updateThumbUI(pos,true);
}if(this._animationPlaying){if(!ended){setTimeout("Exhibit.AnimationFacet.DefaultUI."+this._animationGlueFunc+"()",this._animationFrameDelay);
}else{this._animateStop();
this._updateThumbUI(0,false);
this._facet.clearAllRestrictions();
}}};
Exhibit.AnimationFacet.__augment=function(obj){for(var f in obj){if(f.indexOf("_X_")>=0){continue;
}if(typeof obj[f]=="function"){obj["_X_"+f]=obj[f];
obj[f]=function(){var ret=obj["_X_"+f].apply(obj,arguments);
return ret;
};
}}};


/* animation-inline.js */
Exhibit.AnimationFacet._settingSpecs["inlineshowplay"]={type:"boolean",defaultValue:true};
Exhibit.AnimationFacet._settingSpecs["inlinemodernstyle"]={type:"boolean",defaultValue:false};
Exhibit.AnimationFacet.Inline=function(facet){this._duration=0;
this._dom=null;
this._facet=facet;
this._animationStartTime=0;
this._animationStartPosition=0;
this._animationFrameDelay=100;
this._animationPlaying=false;
this._dragging=false;
this._animationGlueFunc="__animation_glue__"+Exhibit.AnimationFacet._getNextAnimationUnique();
var self=this;
Exhibit.AnimationFacet.Inline[this._animationGlueFunc]=function(){self._animate();
};
};
Exhibit.AnimationFacet.Inline.PLAY_PNG="iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAAAZiS0dEAMkAyQDJYYDmDgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wJBw06OtKSuKQAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAVxJREFUKM+dk89KAlEUxn83fAxh3qSFT+HONrlyE25mV+3O20T0D6KEQgwtC5mNJCLq6KhMiuhCZ+Fp4U0TRKy7ufcc+H3ng/NdRORCRA75xzEiovadA85d133eFz4ASCaTxOPxBPAkIo/7OokBOI6D4zg0m03y+XzC9/2EiOSAU9d18zttZ7PZjWar1aJQKNDpdAAegbNtIkZENJPJ2Mp21WCAdrtFsVQiCAKAB+uksAGnj9NrEECXQvbC933K5TL9fh/g3jp5MSKiR6nUilmpGgMoqmCskN/2qVQqhGEIcBIDmEfRehwKan7cY4But4vneQyHQ4A7u9LiEp7NwSib3iEIAqrVKqPRCODWQqWNVUXR3E4y6EIZDAbUap+Mx2OAGwu9bt3zLIpgoYRfIfV6nclkor+gt50h6fd6NBoNptOpAtcWKu+VMM/zFLiy0Pu+2Y4Blxb6+Ouv+gZldbw7tlbjQQAAAABJRU5ErkJggg==";
Exhibit.AnimationFacet.Inline.PAUSE_PNG="iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAAAZiS0dEAMkAyQDJYYDmDgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wJBw4TAryQIYgAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAP9JREFUKM99kt1xg0AMhD95aCHjspxuoASoybzThtNFbO1FebgfYAzWw83N7Wm10srGcQxOYhgG+4R3AH3fvwHTNLX7Gd4BpPQHnBYgpQQYEOXcVJYcyqNtOMZxJOMiCAx7l+2ekysYtlfh7phRqq9xqcxJwuW4HEkAfN9urbK7kDvy/G+tLLVettxf12tLXkcSRJZRem6y61wy6K9nTnY14rC1964xH8Tv85VJisxDn+XKom0v/ufxWKdd4NjgOTk5UXqyjZPLslCtjMhYGNTPxSrxKc7wS5UtCVexo8xgGIbWc8VcanvRrMLidENTmTbsF6UDmOf7R9n3eT58/wfel7gwBDKMLAAAAABJRU5ErkJggg==";
Exhibit.AnimationFacet.Inline.THUMB_PNG="iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAAAZiS0dEAMwAzADM38FfGgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wIFAsaGOk3cJEAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAgpJREFUKM+dkz9OG0EYxX8zOxvJiMiDwQYbS4QQ2lRIMQoSDRAuwAFSUeQCewSuQJUDcISUSLELKsoAKeKVRdaWEVpEpJ1/KXaxUJQ0mW70vd8370lvBH+ck5OTj8ARsAU0gClwAZwlSfL5uVY8g94Cp0DvzeYmGxuvaTZbTMZjbm6+c3X1DWAAHCdJcjmDK/CL1rq1836HzmoHFUUIKQFwzjEajTg/P+fu7i4D9pMkuZTVw6da69b+wQEr7RWiKEKpmDiOiZVCRYp2u83hh0O01q3KIVGV8dPu7i6NhQZRHBEphVKKOH6BEBBCIPiAkAKt61xfX3f39vZ+SOBobe0Vi4uLBIAAVGLnLd5DCB5fTllaarK+vg5wJIGtbneV4EMp8h7nHNZZTGEwpsA5h3cO78t5t9sF2FJAo16v47xDOomQorRKQCIJhHKhtbMFekEDNBQwnU6nzdpcrYQBPMjII4SoUgS8c1jncM4xmUwAphK4SNMUZx3WWIy1GGswxlCYorReFBhjsNZinSUdpgAXEjhL05TxZFzmNBZjSvgp8+xuDNnPjOFwCHD2VJL+y/n53rvtHnO1OYSURELO+hdCmfvx1yOD/oA8zwdJkmw/leQ4f3jIBv0BWZZhi8qyMRRFgSkKsiyj/7VPnucZcPzPbnc6HZaXl9Fac39/z+3tLaPR6O/d/t9f9RsoTTP4+32UigAAAABJRU5ErkJggg==";
Exhibit.AnimationFacet.Inline.SHAFT_PNG="iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAAAZiS0dEAIgAiACIdJABBgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wIFAsiBOqpkCUAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAbZJREFUKM+dk81uGjEUhT+PPd3WDT8TKBLQNG/ArpHYTJM8Eo/AQ7FDKqRpXqAhVdCgERqqUETSxQy2s5iBkDbNond1fe1zjn3uteCP6Pf7/Ct6vd6ztXgJ9PH4mKOjD1QqVX4uFtzc/OD6+vtfJGIfqLXm5NMJ9fd1lJQIzwPAGEMcxwyHQ5bL5Y7A27Jprfl8esph7RApJUr5+L6PrxRKKmq1Gudn52itdzeQW9Vut8vBuwOkL5FKoZTC998gBDjncNYhPIHWb5lMJoRhmCs3my1KpRIOwAHFYWM3WAvOWWy+S7lcod1uA6AAN53eMp3e8nq4fX9zcBAEhe8CnCtcFLmOcOAEooDmiWNbUK12C+GeuHcnd4htnlO6vS6ri/GFaDQadDodlFRIJZFS4nneDuScxVqLMYaN2XD59ZIoilAAs9mMZqtJpVzBOoe1NgdvX1vUjDEsFguiKMpbNRgMCMOQX3dLqkEVKSW2cNvaJ0VjDA+/H7j6dkWaps+HZH1/z3g0JkkSNmlGmqVkWUaapmRpSpIkjL6MWK/Xr892vV4nCAK01qxWK+bzOXEcvzzb//urHgE3adNcFxKl0AAAAABJRU5ErkJggg==";
Exhibit.AnimationFacet.Inline.prototype.dispose=function(){this._dom=null;
};
Exhibit.AnimationFacet.Inline.prototype.setDuration=function(secs){this._duration=secs;
};
Exhibit.AnimationFacet.Inline.prototype.getDuration=function(){return this._duration;
};
Exhibit.AnimationFacet.Inline.prototype.initUI=function(){var labels=new Exhibit.AnimationFacet.Labels(this._facet,0);
var settings=this._facet._settings;
var showPlay=settings["inlineshowplay"];
var html=null;
if(!settings["inlinemodernstyle"]){var cssWidth=settings["width"]?" width:"+settings["width"]+";":"width:100px;";
var cssHeight=settings["height"]?" height:"+settings["height"]+";":" height:10px;";
var html="<span>"+((showPlay)?'<span class="exhibit-facet-animation-button"></span>':"")+'<div style="display:Inline-Block; margin-left:5px; margin-right:5px;'+cssWidth+'" class="exhibit-facet-animation-shaft-container"><div class="exhibit-facet-animation-shaft" style="position:Relative; width:100%;'+cssHeight+'"><div class="exhibit-facet-animation-shaft-thumb" style="position:Absolute;'+cssHeight+'"></div></div></div></span>';
}else{var cssWidth=settings["width"]?" width:"+settings["width"]+";":"width:100px;";
var _1="border:None; height:15px; background-image:url(data:image/png;base64,"+Exhibit.AnimationFacet.Inline.SHAFT_PNG+"); background-repeat:Repeat-X;";
var _2="border:None; width:15px; height:15px; background-image:url(data:image/png;base64,"+Exhibit.AnimationFacet.Inline.THUMB_PNG+"); background-repeat:None;";
var html="<span>"+((showPlay)?'<span class="exhibit-facet-animation-button"></span>':"")+'<div style="display:Inline-Block; border:None; margin-left:8px; margin-right:8px;'+cssWidth+'" class="exhibit-facet-animation-shaft-container"><div class="exhibit-facet-animation-shaft" style="position:Relative; width:100%; '+_1+'"><div class="exhibit-facet-animation-shaft-thumb" style="position:Absolute; '+_2+'"></div></div></div></span>';
}var el=$(html);
this._dom={elmt:el.get()[0],shaft:$(".exhibit-facet-animation-shaft",el).get()[0],thumb:$(".exhibit-facet-animation-shaft-thumb",el).get()[0],button:$(".exhibit-facet-animation-button",el).get()[0]};
var self=this;
$(this._dom.shaft).mousedown(function(ev){if(ev.which==1){ev.preventDefault();
self._dragging=true;
}});
$(document).mousemove(function(ev){if(self._dragging&&ev.which==1){ev.preventDefault();
var x=ev.pageX-$(self._dom.shaft).offset().left;
self._updateThumbUI(x,false);
}}).mouseup(function(ev){if(self._dragging&&ev.which==1){ev.preventDefault();
var x=ev.pageX-$(self._dom.shaft).offset().left;
if(!self._updateThumbUI(x,true)){self._animationStartTime=(new Date()).getTime();
self._animationStartPosition=x;
}self._dragging=false;
}});
this._showPlayButton(true);
return this._dom.elmt;
};
Exhibit.AnimationFacet.Inline.prototype.postInitUI=function(){this._updateThumbUI(0,false);
};
Exhibit.AnimationFacet.Inline.prototype._showPlayButton=function(b){var self=this;
var obj=(this._facet._settings["inlinemodernstyle"])?Exhibit.AnimationFacet.Inline:Exhibit.AnimationFacet;
$(this._dom.button).html('<img src="data:image/png;base64,'+obj[b?"PLAY_PNG":"PAUSE_PNG"]+'" />');
$("img",this._dom.button).click(b?function(ev){self._animateStart();
}:function(ev){self._animateStop();
});
};
Exhibit.AnimationFacet.Inline.prototype._updateThumbUI=function(x,considerRestrict){var w=$(this._dom.shaft).width();
var ended=(x>w-1);
x=(x<0)?0:x;
x=(x>w-1)?w-1:x;
var th=$(this._dom.thumb);
th.css("left",(x-th.width()/2)+"px");
var t=Math.floor(this._duration*(x/w*1));
if(considerRestrict){this._facet.updateModeParams(t);
}return ended;
};
Exhibit.AnimationFacet.Inline.prototype._animateStart=function(){this._animationPlaying=true;
this._animationStartTime=(new Date()).getTime();
this._animationStartPosition=($(this._dom.thumb).offset().left)-($(this._dom.shaft).offset().left)+($(this._dom.thumb).width()/2);
this._showPlayButton(false);
setTimeout("Exhibit.AnimationFacet.Inline."+this._animationGlueFunc+"()",this._animationFrameDelay);
};
Exhibit.AnimationFacet.Inline.prototype._animateStop=function(){this._animationPlaying=false;
this._showPlayButton(true);
};
Exhibit.AnimationFacet.Inline.prototype._animate=function(){var timeElapsed=(new Date()).getTime()-this._animationStartTime;
var sh_w=$(this._dom.shaft).width();
var pixelsPerMillisecond=sh_w/(this._duration*1000);
var distanceTravelled=timeElapsed*pixelsPerMillisecond;
var pos=this._animationStartPosition+distanceTravelled;
var ended=false;
if(!this._dragging){ended=this._updateThumbUI(pos,true);
}if(this._animationPlaying){if(!ended){setTimeout("Exhibit.AnimationFacet.Inline."+this._animationGlueFunc+"()",this._animationFrameDelay);
}else{this._animateStop();
this._updateThumbUI(0,false);
this._facet.clearAllRestrictions();
}}};


/* animation-slideshare.js */
Exhibit.AnimationFacet._settingSpecs["sswidth"]={type:"int",defaultValue:598};
Exhibit.AnimationFacet._settingSpecs["ssheight"]={type:"int",defaultValue:480};
Exhibit.AnimationFacet._settingSpecs["ssslides"]={type:"text",defaultValue:"simile-exhibit-vgsom-12312308"};
Exhibit.AnimationFacet._settingSpecs["sslabelfromone"]={type:"boolean",defaultValue:false};
Exhibit.AnimationFacet._settingSpecs["ssshowtrack"]={type:"boolean",defaultValue:true};
Exhibit.AnimationFacet.SlideShare=function(facet){this._duration=-1;
this._facet=facet;
this._playerId="ExhibitAnimationFacetSlideShare__slideshare__"+Exhibit.AnimationFacet._getNextAnimationUnique();
this._playerObj=null;
this._lastSlide=-1;
this._$tickbox=null;
this._hideTickbox=false;
this._animationFrameDelay=100;
this._animationPlaying=false;
var fn="__animation_glue__"+Exhibit.AnimationFacet._getNextAnimationUnique();
this._animationGlueFunc="Exhibit.AnimationFacet.SlideShare."+fn+"()";
var self=this;
Exhibit.AnimationFacet.SlideShare[fn]=function(){self._animate();
};
};
Exhibit.AnimationFacet.SlideShare._mapVideoObjectToPlayerId={};
Exhibit.AnimationFacet.SlideShare.prototype.dispose=function(){this._facet=null;
this._playerObj=null;
this._playerId=null;
};
Exhibit.AnimationFacet.SlideShare.prototype.setDuration=function(secs){};
Exhibit.AnimationFacet.SlideShare.prototype.getDuration=function(){if(this._duration<0){var c=this._playerObj.getCurrentSlide();
this._playerObj.last();
this._duration=this._playerObj.getCurrentSlide();
this._playerObj.jumpTo(c);
}return this._duration;
};
Exhibit.AnimationFacet.SlideShare.prototype.initUI=function(){var settings=this._facet._settings;
this._hideTickbox=!settings["showLabel"];
var html='<span style="display:Inline-Block; position:Relative;"><input type="checkbox" class="exhibit-facet-animation-tickbox" style="display:Block; position:Absolute; right:0px; top:0px;" /><div class="exhibit-facet-header">'+((settings["showLabel"])?'<span class="exhibit-facet-header-title">'+settings["facetLabel"]+"</span>":"")+'</div><div style="width:'+settings["sswidth"]+"px; height:"+settings["ssheight"]+'px;"><div id="'+this._playerId+'"></div></div>'+(settings["ssshowtrack"]?'<div style="width:'+settings["sswidth"]+'px;"><div class="exhibit-facet-animation-bar-container"><div class="exhibit-facet-animation-bar" style="position:Relative; width:0px;"></div></div><div class="exhibit-facet-animation-labels" style="position:Relative; height:1em;"><div style="position:Absolute; left:0px;">&mdash;</div><div style="position:Absolute; right:0px;">&mdash;</div><div class="exhibit-facet-animation-labels-time" style="text-align:Center"></div></div></div>':"")+"</span>";
$el=$(html);
var self=this;
this._$tickbox=$($("input.exhibit-facet-animation-tickbox",$el).get()[0]);
if(!settings["showLabel"]){this._$tickbox.css("right","5px").css("top","5px").css("margin","0px");
}this._$tickbox.click(function(ev){var $this=$(this);
if($this.attr("checked")){self._facet.updateModeParams(self._playerObj.getCurrentSlide()-1);
}else{self._facet.clearAllRestrictions();
}});
return $el;
};
Exhibit.AnimationFacet.SlideShare.prototype.postInitUI=function(){var settings=this._facet._settings;
var self=this;
var ssURL="http://static.slidesharecdn.com/swf/ssplayer2.swf";
var flashVars={doc:settings["ssslides"],startSlide:1,rel:0};
swfobject.embedSWF(ssURL,this._playerId,settings["sswidth"],settings["ssheight"],"8",null,flashVars,{allowScriptAccess:"always",wmode:"transparent",allowfullscreen:"true"},{id:this._playerId},function(ev){if(ev.success){self._playerObj=$("#"+self._playerId).get()[0];
setTimeout(self._animationGlueFunc,self._animationFrameDelay);
}else{}});
Exhibit.AnimationFacet.SlideShare._mapVideoObjectToPlayerId[this._playerId]=this;
};
Exhibit.AnimationFacet.SlideShare.prototype._animate=function(){if(this._playerObj.getCurrentSlide){var slide=this._playerObj.getCurrentSlide()-1;
if(slide!=this._lastSlide){this._lastSlide=slide;
this._updateLabels(slide);
this._facet.updateModeParams(slide);
this._$tickbox.attr("checked",this._facet.hasRestrictions()?"checked":"");
}}else{}setTimeout(this._animationGlueFunc,this._animationFrameDelay);
};
Exhibit.AnimationFacet.SlideShare.prototype._updateLabels=function(secs){if(!this._facet._settings["ssshowtrack"]){return ;
}var dur=this.getDuration();
if(dur==0){return ;
}var config={base:this._facet._settings["sslabelfromone"],showAsSeconds:true,inclusiveBounds:true};
var labels=new Exhibit.AnimationFacet.Labels(this._facet,Math.floor(secs),config);
var labs=$(".exhibit-facet-animation-labels div",this._facet._div).each(function(idx){switch(idx){case 0:$(this).html(labels.lowerLabel);
break;
case 1:$(this).html(labels.upperLabel);
break;
case 2:$(this).html(labels.timeLabel);
break;
}});
var barCon=$(".exhibit-facet-animation-bar-container",this._facet._div);
var bar=$(".exhibit-facet-animation-bar",barCon);
var w=barCon.width();
var r=(1*w/dur);
bar.css("width",Math.floor(secs*r)+"px");
};


/* animation-youtube.js */
Exhibit.AnimationFacet._settingSpecs["ytwidth"]={type:"int",defaultValue:280};
Exhibit.AnimationFacet._settingSpecs["ytheight"]={type:"int",defaultValue:170};
Exhibit.AnimationFacet._settingSpecs["ytvideo"]={type:"text",defaultValue:"ILGK83V6h9s"};
Exhibit.AnimationFacet._settingSpecs["ytshowtrack"]={type:"boolean",defaultValue:true};
Exhibit.AnimationFacet.YouTube=function(facet){this._duration=0;
this._facet=facet;
this._playerId="__youtube__"+Exhibit.AnimationFacet._getNextAnimationUnique();
this._divId="ExhibitAnimationFacetYouTube"+this._playerId;
this._playerObj=null;
this._$tickbox=null;
this._hideTickbox=false;
this._animationFrameDelay=100;
this._animationPlaying=false;
var fn="__animation_glue__"+Exhibit.AnimationFacet._getNextAnimationUnique();
this._animationGlueFunc="Exhibit.AnimationFacet.YouTube."+fn+"()";
var self=this;
Exhibit.AnimationFacet.YouTube[fn]=function(){self._animate();
};
};
Exhibit.AnimationFacet.YouTube.YT_UNSTARTED=-1;
Exhibit.AnimationFacet.YouTube.YT_ENDED=0;
Exhibit.AnimationFacet.YouTube.YT_PLAYING=1;
Exhibit.AnimationFacet.YouTube.YT_PAUSED=2;
Exhibit.AnimationFacet.YouTube.YT_BUFFERING=3;
Exhibit.AnimationFacet.YouTube.YT_CUED=5;
Exhibit.AnimationFacet.YouTube._mapVideoObjectToPlayerId={};
Exhibit.AnimationFacet.YouTube.prototype.dispose=function(){this._facet=null;
this._playerObj=null;
this._divId=null;
this._playerId=null;
};
Exhibit.AnimationFacet.YouTube.prototype.setDuration=function(secs){};
Exhibit.AnimationFacet.YouTube.prototype.getDuration=function(){return this._playerObj.getDuration();
};
Exhibit.AnimationFacet.YouTube.prototype.initUI=function(){var settings=this._facet._settings;
this._hideTickbox=!settings["showLabel"];
var html='<span style="display:Inline-Block; position:Relative;"><input type="checkbox" class="exhibit-facet-animation-tickbox" style="display:Block; position:Absolute; right:0px; top:0px;" /><div class="exhibit-facet-header">'+((settings["showLabel"])?'<span class="exhibit-facet-header-title">'+settings["facetLabel"]+"</span>":"")+'</div><div style="width:'+settings["ytwidth"]+"px; height:"+settings["ytheight"]+'px;"><div id="'+this._divId+'"></div></div>'+(settings["ytshowtrack"]?'<div style="width:'+settings["ytwidth"]+'px;"><div class="exhibit-facet-animation-bar-container"><div class="exhibit-facet-animation-bar" style="position:Relative; width:0px;"></div></div><div class="exhibit-facet-animation-labels" style="position:Relative; height:1em;"><div style="position:Absolute; left:0px;">&mdash;</div><div style="position:Absolute; right:0px;">&mdash;</div><div class="exhibit-facet-animation-labels-time" style="text-align:Center"></div></div></div>':"")+"</span>";
$el=$(html);
var self=this;
this._$tickbox=$($("input.exhibit-facet-animation-tickbox",$el).get()[0]);
if(!settings["showLabel"]){this._$tickbox.css("right","5px").css("top","5px").css("margin","0px");
}this._$tickbox.click(function(ev){var $this=$(this);
if($this.attr("checked")){self._facet.updateModeParams(self._playerObj.getCurrentTime());
}else{self._facet.clearAllRestrictions();
}});
return $el;
};
Exhibit.AnimationFacet.YouTube.prototype.postInitUI=function(){var settings=this._facet._settings;
var ytURL="http://www.youtube.com/v/";
swfobject.embedSWF(ytURL+settings["ytvideo"]+"?version=3&enablejsapi=1&title=Video+facet&autohide=2&color=white&egm=0&border=0&iv_load_policy=3&modestbranding=1&rel=0&showinfo=0&fs=0&playerapiid="+this._playerId,this._divId,settings["ytwidth"],settings["ytheight"],"8",null,null,{allowScriptAccess:"always",wmode:"transparent",allowfullscreen:"true"},{id:this._playerId});
Exhibit.AnimationFacet.YouTube._mapVideoObjectToPlayerId[this._playerId]=this;
};
Exhibit.AnimationFacet.YouTube.prototype._animate=function(){if(this._animationPlaying){this._update();
setTimeout(this._animationGlueFunc,this._animationFrameDelay);
}};
Exhibit.AnimationFacet.YouTube.prototype._onStateChange=function(state){switch(state){case Exhibit.AnimationFacet.YouTube.YT_PLAYING:this._animationPlaying=true;
this._disableTickbox(true);
this._update();
setTimeout(this._animationGlueFunc,this._animationFrameDelay);
break;
case Exhibit.AnimationFacet.YouTube.YT_PAUSED:this._animationPlaying=false;
this._disableTickbox(false);
this._update();
break;
case Exhibit.AnimationFacet.YouTube.YT_ENDED:this._animationPlaying=false;
this._disableTickbox(false);
this._updateLabels(0);
this._facet.clearAllRestrictions();
break;
}};
Exhibit.AnimationFacet.YouTube.prototype._disableTickbox=function(b){this._$tickbox.attr("disabled",b);
if(this._hideTickbox){this._$tickbox.css("display",(b?"None":"Inline"));
}};
Exhibit.AnimationFacet.YouTube.prototype._update=function(secs){var secs=(secs==undefined)?this._playerObj.getCurrentTime():secs;
this._updateLabels(secs);
this._facet.updateModeParams(secs);
this._$tickbox.attr("checked",this._facet.hasRestrictions()?"checked":"");
};
Exhibit.AnimationFacet.YouTube.prototype._updateLabels=function(secs){if(!this._facet._settings["ytshowtrack"]){return ;
}var dur=this.getDuration();
if(dur==0){return ;
}var labels=new Exhibit.AnimationFacet.Labels(this._facet,Math.floor(secs));
var labs=$(".exhibit-facet-animation-labels div",this._facet._div).each(function(idx){switch(idx){case 0:$(this).html(labels.lowerLabel);
break;
case 1:$(this).html(labels.upperLabel);
break;
case 2:$(this).html(labels.timeLabel);
break;
}});
var barCon=$(".exhibit-facet-animation-bar-container",this._facet._div);
var bar=$(".exhibit-facet-animation-bar",barCon);
var w=barCon.width();
var r=(1*w/dur);
bar.css("width",Math.floor(secs*r)+"px");
};
function onYouTubePlayerReady(pid){var self=Exhibit.AnimationFacet.YouTube._mapVideoObjectToPlayerId[pid];
var n="__EVENT_HANDLER__"+pid;
Exhibit.AnimationFacet.YouTube[n]=function(state){self._onStateChange(state);
};
self._playerObj=document.getElementById(pid);
self._playerObj.addEventListener("onStateChange","Exhibit.AnimationFacet.YouTube."+n);
}

/* swfobject.js */
var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;
if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;
if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;
X=false;
ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");
ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);
ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);
ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;
}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);
if(ad){ab=ad.GetVariable("$version");
if(ab){X=true;
ab=ab.split(" ")[1].split(",");
ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];
}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac};
}(),k=function(){if(!M.w3){return ;
}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f();
}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false);
}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);
f();
}});
if(O==top){(function(){if(J){return ;
}try{j.documentElement.doScroll("left");
}catch(X){setTimeout(arguments.callee,0);
return ;
}f();
})();
}}if(M.wk){(function(){if(J){return ;
}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);
return ;
}f();
})();
}s(f);
}}();
function f(){if(J){return ;
}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));
Z.parentNode.removeChild(Z);
}catch(aa){return ;
}J=true;
var X=U.length;
for(var Y=0;
Y<X;
Y++){U[Y]();
}}function K(X){if(J){X();
}else{U[U.length]=X;
}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false);
}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false);
}else{if(typeof O.attachEvent!=D){i(O,"onload",Y);
}else{if(typeof O.onload=="function"){var X=O.onload;
O.onload=function(){X();
Y();
};
}else{O.onload=Y;
}}}}}function h(){if(T){V();
}else{H();
}}function V(){var X=j.getElementsByTagName("body")[0];
var aa=C(r);
aa.setAttribute("type",q);
var Z=X.appendChild(aa);
if(Z){var Y=0;
(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");
if(ab){ab=ab.split(" ")[1].split(",");
M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];
}}else{if(Y<10){Y++;
setTimeout(arguments.callee,10);
return ;
}}X.removeChild(aa);
Z=null;
H();
})();
}else{H();
}}function H(){var ag=o.length;
if(ag>0){for(var af=0;
af<ag;
af++){var Y=o[af].id;
var ab=o[af].callbackFn;
var aa={success:false,id:Y};
if(M.pv[0]>0){var ae=c(Y);
if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);
if(ab){aa.success=true;
aa.ref=z(Y);
ab(aa);
}}else{if(o[af].expressInstall&&A()){var ai={};
ai.data=o[af].expressInstall;
ai.width=ae.getAttribute("width")||"0";
ai.height=ae.getAttribute("height")||"0";
if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class");
}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align");
}var ah={};
var X=ae.getElementsByTagName("param");
var ac=X.length;
for(var ad=0;
ad<ac;
ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value");
}}P(ai,ah,Y,ab);
}else{p(ae);
if(ab){ab(aa);
}}}}}else{w(Y,true);
if(ab){var Z=z(Y);
if(Z&&typeof Z.SetVariable!=D){aa.success=true;
aa.ref=Z;
}ab(aa);
}}}}}function z(aa){var X=null;
var Y=c(aa);
if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y;
}else{var Z=Y.getElementsByTagName(r)[0];
if(Z){X=Z;
}}}return X;
}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312);
}function P(aa,ab,X,Z){a=true;
E=Z||null;
B={success:false,id:X};
var ae=c(X);
if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);
Q=null;
}else{l=ae;
Q=X;
}aa.id=R;
if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310";
}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137";
}j.title=j.title.slice(0,47)+" - Flash Player Installation";
var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;
if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac;
}else{ab.flashvars=ac;
}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");
X+="SWFObjectNew";
Y.setAttribute("id",X);
ae.parentNode.insertBefore(Y,ae);
ae.style.display="none";
(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae);
}else{setTimeout(arguments.callee,10);
}})();
}u(aa,ab,X);
}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");
Y.parentNode.insertBefore(X,Y);
X.parentNode.replaceChild(g(Y),X);
Y.style.display="none";
(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y);
}else{setTimeout(arguments.callee,10);
}})();
}else{Y.parentNode.replaceChild(g(Y),Y);
}}function g(ab){var aa=C("div");
if(M.win&&M.ie){aa.innerHTML=ab.innerHTML;
}else{var Y=ab.getElementsByTagName(r)[0];
if(Y){var ad=Y.childNodes;
if(ad){var X=ad.length;
for(var Z=0;
Z<X;
Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true));
}}}}}return aa;
}function u(ai,ag,Y){var X,aa=c(Y);
if(M.wk&&M.wk<312){return X;
}if(aa){if(typeof ai.id==D){ai.id=Y;
}if(M.ie&&M.win){var ah="";
for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae];
}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"';
}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"';
}}}}}var af="";
for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />';
}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";
N[N.length]=ai.id;
X=c(ai.id);
}else{var Z=C(r);
Z.setAttribute("type",q);
for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac]);
}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac]);
}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab]);
}}aa.parentNode.replaceChild(Z,aa);
X=Z;
}}return X;
}function e(Z,X,Y){var aa=C("param");
aa.setAttribute("name",X);
aa.setAttribute("value",Y);
Z.appendChild(aa);
}function y(Y){var X=c(Y);
if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";
(function(){if(X.readyState==4){b(Y);
}else{setTimeout(arguments.callee,10);
}})();
}else{X.parentNode.removeChild(X);
}}}function b(Z){var Y=c(Z);
if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null;
}}Y.parentNode.removeChild(Y);
}}function c(Z){var X=null;
try{X=j.getElementById(Z);
}catch(Y){}return X;
}function C(X){return j.createElement(X);
}function i(Z,X,Y){Z.attachEvent(X,Y);
I[I.length]=[Z,X,Y];
}function F(Z){var Y=M.pv,X=Z.split(".");
X[0]=parseInt(X[0],10);
X[1]=parseInt(X[1],10)||0;
X[2]=parseInt(X[2],10)||0;
return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false;
}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return ;
}var aa=j.getElementsByTagName("head")[0];
if(!aa){return ;
}var X=(ad&&typeof ad=="string")?ad:"screen";
if(ab){n=null;
G=null;
}if(!n||G!=X){var Z=C("style");
Z.setAttribute("type","text/css");
Z.setAttribute("media",X);
n=aa.appendChild(Z);
if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1];
}G=X;
}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y);
}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"));
}}}function w(Z,X){if(!m){return ;
}var Y=X?"visible":"hidden";
if(J&&c(Z)){c(Z).style.visibility=Y;
}else{v("#"+Z,"visibility:"+Y);
}}function L(Y){var Z=/[\\\"<>\.;]/;
var X=Z.exec(Y)!=null;
return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y;
}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;
for(var ab=0;
ab<ac;
ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2]);
}var Z=N.length;
for(var aa=0;
aa<Z;
aa++){y(N[aa]);
}for(var Y in M){M[Y]=null;
}M=null;
for(var X in swfobject){swfobject[X]=null;
}swfobject=null;
});
}}();
return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};
Y.id=ab;
Y.swfVersion=X;
Y.expressInstall=aa;
Y.callbackFn=Z;
o[o.length]=Y;
w(ab,false);
}else{if(Z){Z({success:false,id:ab});
}}},getObjectById:function(X){if(M.w3){return z(X);
}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};
if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);
K(function(){ae+="";
ag+="";
var aj={};
if(af&&typeof af===r){for(var al in af){aj[al]=af[al];
}}aj.data=ab;
aj.width=ae;
aj.height=ag;
var am={};
if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak];
}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai];
}else{am.flashvars=ai+"="+Z[ai];
}}}if(F(Y)){var an=u(aj,am,ah);
if(aj.id==ah){w(ah,true);
}X.success=true;
X.ref=an;
}else{if(aa&&A()){aj.data=aa;
P(aj,am,ah,ac);
return ;
}else{w(ah,true);
}}if(ac){ac(X);
}});
}else{if(ac){ac(X);
}}},switchOffAutoHideShow:function(){m=false;
},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]};
},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X);
}else{return undefined;
}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y);
}},removeSWF:function(X){if(M.w3){y(X);
}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X);
}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;
if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1];
}if(aa==null){return L(Z);
}var Y=Z.split("&");
for(var X=0;
X<Y.length;
X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)));
}}}return"";
},expressInstallCallback:function(){if(a){var X=c(R);
if(X&&l){X.parentNode.replaceChild(l,X);
if(Q){w(Q,true);
if(M.ie&&M.win){l.style.display="block";
}}if(E){E(B);
}}a=false;
}}};
}();
