

/* data-editor.js */
if(!window.jQuery){window.jQuery=SimileAjax.jQuery;
}Exhibit.DataEdit=function(){};
Exhibit.DataEdit.X_DISABLE_MODE_BUTTONS=false;
Exhibit.DataEdit.EDIT_BUTTON="exhibitDataEditButton";
Exhibit.DataEdit.EDIT_BUTTON_SYMBOL="exhibitDataEditButtonSymbol";
Exhibit.DataEdit.EDIT_BUTTON_TEXT="exhibitDataEditButtonText";
Exhibit.DataEdit.EDIT_STATUS_ID="exhibitDataEditMsg";
Exhibit.DataEdit.MODE_EDIT_ID="exhibitDataEditModeEdit";
Exhibit.DataEdit.MODE_CLONE_ID="exhibitDataEditModeClone";
Exhibit.DataEdit.MODE_CREATE_ID="exhibitDataEditModeCreate";
Exhibit.DataEdit.MODE_DELETE_ID="exhibitDataEditModeDelete";
Exhibit.DataEdit.LENS_ROLE_BUTTON="editorButton";
Exhibit.DataEdit.LENS_BUTTON_EDIT="edit";
Exhibit.DataEdit.LENS_BUTTON_CLONE="clone";
Exhibit.DataEdit.LENS_BUTTON_CREATE="create";
Exhibit.DataEdit.LENS_BUTTON_DELETE="delete";
Exhibit.DataEdit.LENS_BUTTON_CSS_ON="exhibitEditorButtonOn";
Exhibit.DataEdit.LENS_BUTTON_CSS_OFF="exhibitEditorButtonOff";
Exhibit.DataEdit.LENS_ROLE_STATUS="editorStatus";
Exhibit.DataEdit.LENS_ROLE_ITEM_LENS="editor";
Exhibit.DataEdit.LENS_BUTTON_LENS_SAVE="save";
Exhibit.DataEdit.LENS_ROLE_ITEM_STATUS="editorStatus";
Exhibit.DataEdit.EDIT_MODE_REFDATA={};
Exhibit.DataEdit._DEBUG_=false;
Exhibit.DataEdit._lock_=null;
Exhibit.DataEdit._editors_=null;
Exhibit.DataEdit._lifeCycleEventHandlers_=[];
Exhibit.DataEdit.onSaveErrors=[];
Exhibit.DataEdit.activateEdit=function(){if(!Exhibit.DataEdit._lock_){Exhibit.DataEdit.activateMode(Exhibit.DataEdit.MODE_EDIT_ID);
}};
Exhibit.DataEdit.deactivateEdit=function(){if(Exhibit.DataEdit._lock_==Exhibit.DataEdit.MODE_EDIT_ID){Exhibit.DataEdit.deactivateMode(Exhibit.DataEdit.MODE_EDIT_ID);
}};
Exhibit.Lens._compileTemplate=Exhibit.Lens.compileTemplate;
Exhibit.Lens.compileTemplate=function(B,D,A){var C=$(B);
if(C.attr("ex:onshow")){C.attr("_ex:originalOnShow",C.attr("ex:onshow"));
}C.attr("ex:onshow","Exhibit.Lens.onShow(this)");
return Exhibit.Lens._compileTemplate(B,D,A);
};
Exhibit.Lens.onShow=function(C){if($(C).attr("_ex:originalOnShow")){var A=$(C).attr("_ex:originalOnShow");
try{(new Function(A)).call(C);
}catch(B){SimileAjax.Debug.log(B);
}}if(Exhibit.DataEdit._lock_){Exhibit.DataEdit.injectIntoItemDiv(C);
}};
Exhibit.DataEdit.injectIntoItemDiv=function(B){var A=$(B).attr("ex:itemid");
Exhibit.DataEdit._buildOverlayHTML(A,B);
};
Exhibit.DataEdit.log=function(){if(window.console&&Exhibit.DataEdit._DEBUG_){console.log.apply(this,arguments);
}};
Exhibit.DataEdit.toggleMode=function(B){var A=Exhibit.DataEdit.EDIT_MODE_REFDATA[B];
if(Exhibit.DataEdit._lock_==B){Exhibit.DataEdit.deactivateMode(B);
}else{if(Exhibit.DataEdit._lock_!=null){return ;
}else{Exhibit.DataEdit.activateMode(B);
}}};
Exhibit.DataEdit.activateMode=function(B){var A=Exhibit.DataEdit.EDIT_MODE_REFDATA[B];
if(A.eventBefore&&!Exhibit.DataEdit._invokeEventHandlers(A.eventBefore)){return ;
}Exhibit.DataEdit._editors_={};
Exhibit.DataEdit._setLock(B);
database._listeners.fire("onAfterLoadingItems",[]);
Exhibit.DataEdit._invokeEventHandlers(A.event);
};
Exhibit.DataEdit.deactivateMode=function(B){var A=Exhibit.DataEdit.EDIT_MODE_REFDATA[B];
if(Exhibit.DataEdit._lock_==B){if(A.eventBeforeCancel&&!Exhibit.DataEdit._invokeEventHandlers(A.eventBeforeCancel)){return ;
}Exhibit.DataEdit._setLock(null);
database._listeners.fire("onAfterLoadingItems",[]);
Exhibit.DataEdit._invokeEventHandlers(A.eventCancel);
}};
Exhibit.DataEdit._buildOverlayHTML=function(F,E){var A=Exhibit.DataEdit.EDIT_MODE_REFDATA[Exhibit.DataEdit._lock_];
var D=$(E);
var B="__MARKER__"+Exhibit.DataEdit.Editor._escapeString(F);
D.append('<div id="'+B+'" class="exhibitDataEditSelectorOff" style="position:Absolute ; cursor:Help" onclick="'+A.overlayOnClick+"('"+F+"',event)\"></div>");
D.mouseover(function(J){var H=$("#"+B);
if(H.attr("title")=="select"){return ;
}var K=D.position();
var G=D.outerWidth(true);
var I=D.outerHeight(true);
H.removeClass("exhibitDataEditSelectorOff").addClass("exhibitDataEditSelectorOn").css("top",K.top+"px").css("left",K.left+"px").css("width",G+"px").css("height",I+"px").attr("title","select");
}).mouseout(function(){$("#"+B).removeClass("exhibitDataEditSelectorOn").addClass("exhibitDataEditSelectorOff").attr("title",null);
});
if(Exhibit.DataEdit._lock_==Exhibit.DataEdit.MODE_EDIT_ID){var C='<input type="text" class="__GRAB_TABS__" style="width:0px; height:0px; border:None; padding:0px; margin:0px; float:Left;" onfocus="'+A.overlayOnClick+"('"+F+"')\"/>";
D.prepend(C).append(C);
}};
Exhibit.DataEdit.edit=function(C,B){if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeEdit",C)){return ;
}var A=function(D){return($(this).attr("ex:itemid"));
};
$("*").filter(A).each(function(D){var G=$(this).attr("ex:itemid");
if(G==C){Exhibit.DataEdit.edit.div(C,this,B);
}else{var E="__MARKER__"+Exhibit.DataEdit.Editor._escapeString(G);
var F=$(this).offset();
$("#"+E,this).css("top",F.top+"px").css("left",F.left+"px");
}});
Exhibit.DataEdit._invokeEventHandlers("onEdit",C);
};
Exhibit.DataEdit.edit.div=function(D,A,E){var C="__MARKER__"+Exhibit.DataEdit.Editor._escapeString(D);
$("#"+C,A).remove();
var B=null;
if(!Exhibit.DataEdit._editors_[D]){B=new Exhibit.DataEdit.Editor(D,A,E);
Exhibit.DataEdit._editors_[D]=B;
}else{B=Exhibit.DataEdit._editors_[D];
B.updateTargetDOMElement(A);
}B.apply();
};
Exhibit.DataEdit.de1ete=function(C,B){if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeDelete",C)){return ;
}if(confirm("Do you really want to delete this item?\nItem: "+C)){var A=database._spo[C];
for(p in A){database.removeObjects(C,p);
}}else{return ;
}Exhibit.DataEdit._setLock(null);
database._listeners.fire("onAfterLoadingItems",[]);
Exhibit.DataEdit._invokeEventHandlers("onDelete",C);
};
Exhibit.DataEdit.clone=function(H,I){if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeClone",H)){return ;
}if(confirm("Do you really want to clone this item?\nItem: "+H)){var L=(database.getObject(H,"id"))?"id":"label";
var K=database.getObject(H,L);
if(!K||K!=H){return ;
}if(K.match(/\d+$/)){var E=K.match(/(.*?)(\d*)$/);
var B=E[1];
var D=(E[2].length)?parseInt(E[2]):0;
do{D++;
}while(database.containsItem(B+D));
K=B+D;
}else{K=K+"2";
}var C=database._spo[H];
var F={};
for(var A in C){var J=C[A];
if(typeof J=="object"){var O=[];
for(var G=0;
G<J.length;
G++){O.push(J[G]);
}F[A]=O;
}else{F[A]=J;
}}F[L]=[K];
var N="onCloning";
for(var G=0;
G<Exhibit.DataEdit._lifeCycleEventHandlers_.length;
G++){var M=Exhibit.DataEdit._lifeCycleEventHandlers_[G];
F=(M[N])?M[N](H,K,F):F;
}database.loadData({items:[F]});
}else{return ;
}Exhibit.DataEdit._setLock(null);
database._listeners.fire("onAfterLoadingItems",[]);
Exhibit.DataEdit._invokeEventHandlers("onClone",H);
};
Exhibit.DataEdit.create=function(E,F){if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeCreate",E)){return ;
}var I={};
var B=database._spo[E];
for(p in B){var A=database.getObject(E,p);
if(typeof A=="number"){I[p]=0;
}else{if(typeof A=="boolean"){I[p]=false;
}else{if(typeof A=="string"){if(A.match(/^(\+|\-)?\d+(\.\d+)?$/)){I[p]=0;
}else{I[p]="";
}}else{I[p]="";
}}}}var D=database.getObject(E,"type");
I["type"]=(D)?D:"item";
var G=(database.getObject(E,"id"))?"id":"label";
I[G]="item"+(new Date().getTime());
var J="onCreating";
for(var C=0;
C<Exhibit.DataEdit._lifeCycleEventHandlers_.length;
C++){var H=Exhibit.DataEdit._lifeCycleEventHandlers_[C];
I=(H[J])?H[J](I[G],I):I;
}database.loadData({items:[I]});
Exhibit.DataEdit._setLock(null);
database._listeners.fire("onAfterLoadingItems",[]);
Exhibit.DataEdit._invokeEventHandlers("onCreate",E);
};
Exhibit.DataEdit.save=function(F){var I=this;
var D=Exhibit.DataEdit._editors_[F];
var B=D.getFields();
var H={};
for(var E in B){H[E]=B[E].getValue();
}if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeSave",F,H)){return ;
}for(var E in B){B[E].setError(false);
}Exhibit.DataEdit.onSaveErrors=[];
for(var E in B){var C=B[E];
var A=Exhibit.DataEdit._saveField(F,E,C);
if(A){C.setError(true);
Exhibit.DataEdit._setStatusMessage(F,A);
return ;
}}var G=Exhibit.DataEdit._invokeEventHandlers("onSave",F,H);
Exhibit.DataEdit._checkSaveFailure(F,G);
};
Exhibit.DataEdit.onChange=function(H,B){var C=Exhibit.DataEdit._editors_[H];
var A=C.getFields();
var F=A[B];
var E={};
E[B]=F.getValue();
if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeSave",H,E)){return ;
}Exhibit.DataEdit.onSaveErrors=[];
var D=Exhibit.DataEdit._saveField(H,B,F);
if(D){F.setError(true);
Exhibit.DataEdit._setStatusMessage(H,D);
}var G=Exhibit.DataEdit._invokeEventHandlers("onSave",H,E);
Exhibit.DataEdit._checkSaveFailure(H,G);
};
Exhibit.DataEdit._setLock=function(C){Exhibit.DataEdit._lock_=C;
for(var B in Exhibit.DataEdit.EDIT_MODE_REFDATA){var E=Exhibit.DataEdit.EDIT_MODE_REFDATA[B];
var A=(B==C);
$("#"+B).each(function(){$("."+Exhibit.DataEdit.EDIT_BUTTON_SYMBOL,this).html(A?'<span class="on">&#10004;</span>':'<span class="off">&#10006;</span>');
$("."+Exhibit.DataEdit.EDIT_BUTTON_TEXT,this).html(A?'<span class="on">'+E.textOn+"</span>":'<span class="off">'+E.textOff+"</span>");
});
var F=!A?Exhibit.DataEdit.LENS_BUTTON_CSS_ON:Exhibit.DataEdit.LENS_ROLE_ACTIVATE_CSS_OFF;
var H=A?Exhibit.DataEdit.LENS_BUTTON_CSS_ON:Exhibit.DataEdit.LENS_ROLE_ACTIVATE_CSS_OFF;
var G=E.customButton;
var D=function(I){return $(this).attr("ex:role")==G;
};
$("*").filter(D).removeClass(F).addClass(H);
}};
Exhibit.DataEdit._checkSaveFailure=function(D,C){if(!C){if(Exhibit.DataEdit.onSaveErrors.length>0){var B="";
for(var A=0;
A<Exhibit.DataEdit.onSaveErrors.length;
A++){B=B+Exhibit.DataEdit.onSaveErrors[A]+"\n";
}Exhibit.DataEdit._setStatusMessage(D,B,true);
}else{Exhibit.DataEdit._setStatusMessage(D,"Saved locally, persistence failed",true);
}}else{Exhibit.DataEdit._setStatusMessage(D,"Saved",false);
}};
Exhibit.DataEdit._setStatusMessage=function(D,A,B){var C="#"+Exhibit.DataEdit.EDIT_STATUS_ID+"_"+D;
$(C).html(A);
if(B&&$(C).length==0){alert(A);
}};
Exhibit.DataEdit._saveField=function(J,I,H){var B=H.getValue();
var E=H._validators;
if(E){var A=E.split(",");
for(var G=0;
G<A.length;
G++){var D=null;
var K=A[G];
var L=false;
var C=K.toLowerCase();
if(Exhibit.DataEdit._internalValidators[C]){D=Exhibit.DataEdit._internalValidators[C](B);
L=true;
}if(!L&&(window[K])&&(typeof window[K]=="function")){D=window[K](B);
L=true;
}if(!L){}if(D!=null){return D;
}}}if(B!=undefined){database.removeObjects(J,I);
if(B instanceof Array){Exhibit.DataEdit.log("Updating(array)",I,B);
for(var F=0;
F<B.length;
F++){database.addStatement(J,I,B[F]);
}}else{Exhibit.DataEdit.log("Updating(scalar)",I,B);
database.addStatement(J,I,B);
}}return null;
};
Exhibit.DataEdit.addEventHandler=function(A){if(A){Exhibit.DataEdit._lifeCycleEventHandlers_.push(A);
}};
Exhibit.DataEdit._invokeEventHandlers=function(D,F,E){var A=true;
for(var B=0;
B<Exhibit.DataEdit._lifeCycleEventHandlers_.length;
B++){var C=Exhibit.DataEdit._lifeCycleEventHandlers_[B];
if(C[D]){A=A&&C[D](F,E);
}}return A;
};
Exhibit.DataEdit.validateIsNotEmpty=function(A){var B="Cannot be empty";
if(A==undefined){return B;
}else{if((typeof A=="string")&&(A.length==0)){return B;
}else{if((typeof A=="number")&&(A==0)){return B;
}else{if((typeof A=="object")&&(A instanceof Array)&&(A.length==0)){return B;
}else{return null;
}}}}};
Exhibit.DataEdit.validateIsURL=function(A){var B="Must be a web address";
if(A==undefined||(typeof A!="string")){return B;
}return(!A.match(/^http:\/\//))?B:null;
};
Exhibit.DataEdit._internalValidators={"notempty":Exhibit.DataEdit.validateIsNotEmpty,"isurl":Exhibit.DataEdit.validateIsURL};
Exhibit.DataEdit._setup_injectActivateButton=function(){if(Exhibit.DataEdit.X_DISABLE_MODE_BUTTONS){return ;
}var G="";
var D=0;
for(var E in Exhibit.DataEdit.EDIT_MODE_REFDATA){var B=Exhibit.DataEdit.EDIT_MODE_REFDATA[E];
var A=B.customButton;
var F=function(H){return($(this).attr("ex:role")==Exhibit.DataEdit.LENS_ROLE_BUTTON)&&($(this).attr("ex:type")==A);
};
var C=$("*").filter(F);
if(C.length>0){C.each(function(I){try{var H=E;
$(this).click(function(){Exhibit.DataEdit.toggleMode(H);
}).addClass(Exhibit.DataEdit.LENS_BUTTON_CSS_OFF);
}catch(J){SimileAjax.Debug.warn(J);
}});
D++;
}else{G+='<span id="'+E+'" class="'+Exhibit.DataEdit.EDIT_BUTTON+'"><a href="javascript:Exhibit.DataEdit.toggleMode(\''+E+'\');"><div><span class="'+Exhibit.DataEdit.EDIT_BUTTON_SYMBOL+'"><span class="off">&#10006;</span></span>&nbsp;<span class="'+Exhibit.DataEdit.EDIT_BUTTON_TEXT+'"><span class="off">'+B.textOff+"</span></span></div></a></span>";
}}if(D==0&&G.length){G='<div style="position:Fixed; float:Right; right:0.5em;  top:0.5em; z-index:1000;">'+G+"</div>";
$("body").first().prepend(G);
}};
$(document).ready(function(){if(!Exhibit.DataEdit._invokeEventHandlers("onBeforeInit")){return ;
}Exhibit.DataEdit._setup_injectActivateButton();
Exhibit.DataEdit._invokeEventHandlers("onInit");
});
Exhibit.DataEdit.EDIT_MODE_REFDATA[Exhibit.DataEdit.MODE_EDIT_ID]={textOff:"Edit item",textOn:"Stop editing",customButton:Exhibit.DataEdit.LENS_BUTTON_EDIT,overlayOnClick:"Exhibit.DataEdit.edit",eventBefore:"onBeforeActivate",eventBeforeCancel:"onBeforeActivateClose",event:"onActivate",eventCancel:"onActivateClose"};
Exhibit.DataEdit.EDIT_MODE_REFDATA[Exhibit.DataEdit.MODE_CLONE_ID]={textOff:"Clone item",textOn:"Cancel clone",customButton:Exhibit.DataEdit.LENS_BUTTON_CLONE,overlayOnClick:"Exhibit.DataEdit.clone",eventBefore:null,eventBeforeCancel:null,event:null,eventCancel:null};
Exhibit.DataEdit.EDIT_MODE_REFDATA[Exhibit.DataEdit.MODE_CREATE_ID]={textOff:"Create item",textOn:"Cancel create",customButton:Exhibit.DataEdit.LENS_BUTTON_CREATE,overlayOnClick:"Exhibit.DataEdit.create",eventBefore:null,eventBeforeCancel:null,event:null,eventCancel:null};
Exhibit.DataEdit.EDIT_MODE_REFDATA[Exhibit.DataEdit.MODE_DELETE_ID]={textOff:"Delete item",textOn:"Cancel delete",customButton:Exhibit.DataEdit.LENS_BUTTON_DELETE,overlayOnClick:"Exhibit.DataEdit.de1ete",eventBefore:null,eventBeforeCancel:null,event:null,eventCancel:null};


/* editor.js */
Exhibit.DataEdit.LensSpec=function(A,B){this._type=A;
this._lensHTML=B;
};
Exhibit.DataEdit.LensSpec.X_ENABLE_AUTO_RESIZE_UI=false;
Exhibit.DataEdit.LensSpec._lenses=[];
Exhibit.DataEdit.LensSpec._DEBUG_=false;
Exhibit.DataEdit.LensSpec.prototype.getType=function(){return this._type;
};
Exhibit.DataEdit.LensSpec.prototype.getHTML=function(){return this._lensHTML;
};
$(document).ready(function(){var A=function(B){return $(this).attr("ex:role")==Exhibit.DataEdit.LENS_ROLE_ITEM_LENS;
};
if(window.console&&Exhibit.DataEdit.LensSpec._DEBUG_){console.log("Searching for editor lenses");
}$("*").filter(A).each(function(C){try{var B=$(this).attr("ex:itemType");
var D=$(this).html();
if(window.console&&Exhibit.DataEdit.LensSpec._DEBUG_){console.log("  Lens found: "+B);
}Exhibit.DataEdit.LensSpec._lenses[B]=new Exhibit.DataEdit.LensSpec(B,D);
$(this).remove();
}catch(E){SimileAjax.Debug.warn(E);
}});
});
Exhibit.DataEdit.Editor=function(B,A,C){this._itemId=B;
this._jqThis=A;
this._fields={};
this._hasSaveButton=false;
this._hasCancelButton=false;
this._hasStatus=false;
this._clickEvent=C;
};
Exhibit.DataEdit.Editor._DEBUG_=false;
Exhibit.DataEdit.Editor._BGCOL_="#dddddd";
Exhibit.DataEdit.Editor._ERRCOL_="#ff8888";
Exhibit.DataEdit.Editor._COMPONENTS_=["TextField","NumberField","EnumField","ListField","TickListField"];
Exhibit.DataEdit.Editor.prototype.updateTargetDOMElement=function(A){this._jqThis=A;
};
Exhibit.DataEdit.Editor.prototype.apply=function(){var B=database.getObject(this._itemId,"type");
var A=(B)?Exhibit.DataEdit.LensSpec._lenses[B]:null;
if(A){this.log("applyWithLens() "+this._itemId+":"+B);
this.applyWithLens(A);
}else{this.log("applyWithoutLens() "+this._itemId+":"+B);
this.applyWithoutLens();
}};
Exhibit.DataEdit.Editor.prototype.applyWithLens=function(B){var A=this;
$(A._jqThis).html(B._lensHTML);
var E=function(I){return($(this).attr("ex:role")==Exhibit.DataEdit.LENS_ROLE_BUTTON)&&($(this).attr("ex:type")==Exhibit.DataEdit.LENS_BUTTON_LENS_SAVE);
};
$("*",A._jqThis).filter(E).each(function(I){$(this).click(function(){Exhibit.DataEdit.save(A._itemId);
});
A._hasSaveButton=true;
});
var H=function(I){return $(this).attr("ex:role")==Exhibit.DataEdit.LENS_ROLE_ITEM_STATUS;
};
$("*",A._jqThis).filter(H).each(function(I){$(this).attr("id",Exhibit.DataEdit.EDIT_STATUS_ID+"_"+A._itemId);
A._hasStatus=true;
});
var G=[];
var D=null;
for(var C=0;
C<Exhibit.DataEdit.Editor._COMPONENTS_.length;
C++){var F=Exhibit.DataEdit.Editor._COMPONENTS_[C];
A.log("Scanning for "+F);
Exhibit.DataEdit.Editor[F].domFilter(A._jqThis,function(I){var M,L,K;
try{M=A._getContent(this);
if(!M){throw"Missing target (ex:content)";
}L=(A._exists(M))?A._getValues(M):undefined;
try{K=new Exhibit.DataEdit.Editor[F](this,A._itemId,M,L,false);
K._saveOnChange=(!A._hasSaveButton);
if(!D){D=K;
}}catch(J){A.log(J,M,L,this);
SimileAjax.Debug.warn(J);
}A._addFieldComponent(this,M,K,G,true);
}catch(J){A.log(J,M,L,this);
}});
}for(var C=0;
C<G.length;
C++){G[C]();
}if(D){D.focus();
}};
Exhibit.DataEdit.Editor.prototype.applyWithoutLens=function(){var A=this;
$(".__GRAB_TABS__",A._jqThis).remove();
var F=[];
var B=null;
var E=null;
var D=function(G){return $(this).attr("ex:content");
};
$("*",A._jqThis).filter(D).each(function(G){var M,L,J;
try{var K=$(this).attr("ex:content");
if(!K){return ;
}var M=A._getContent(this);
if(M){L=A._getValues(M);
try{var H=A._guessFieldType(K,L);
J=new Exhibit.DataEdit.Editor[H](this,A._itemId,M,L,true);
J._saveOnChange=true;
if(A._inside(this)){B=J;
}if(!E){E=J;
}}catch(I){A.log(I,M,L,A);
SimileAjax.Debug.warn(I);
}A._addFieldComponent(this,M,J,F,false);
}}catch(I){A.log(I,M,L,A);
}});
for(var C=0;
C<F.length;
C++){F[C]();
}if(B){B.focus();
}else{if(E){E.focus();
}}};
Exhibit.DataEdit.Editor.prototype._guessFieldType=function(B,A){if((typeof A=="object")&&(A instanceof Array)){return"ListField";
}if(typeof A=="number"){return"NumberField";
}if(typeof A=="string"){return"TextField";
}return"TextField";
};
Exhibit.DataEdit.Editor.prototype._exists=function(A){return database.getObject(this._itemId,A);
};
Exhibit.DataEdit.Editor.prototype._getValues=function(B){var A=[];
database.getObjects(this._itemId,B).visit(function(C){A.push(C);
});
return(A.length>1)?A:A[0];
};
Exhibit.DataEdit.Editor.prototype._getContent=function(C){var B=$(C).attr("ex:content");
if(!B){return null;
}var A=B.match(/^\.(.+)?\.?/);
return(A&&A.length>1)?A[1]:null;
};
Exhibit.DataEdit.Editor.prototype._addFieldComponent=function(C,B,G,H,F){if(G){this._fields[B]=G;
var E=G.getHTML(H);
var A={width:$(C).width(),height:$(C).height()};
var I=G["_prefDimensions"];
if(Exhibit.DataEdit.LensSpec.X_ENABLE_AUTO_RESIZE_UI&&!F&&I&&((A.width<I.width)||(A.height<I.height))){E='<span style="display:Inline-Block; position:Relative; width:'+A.width+"px; height:"+A.height+'px;">'+E+"</span>";
var D=$(E);
D.mouseenter(function(J){$(this).width(I.width).height(I.height).addClass("exhibitDataEditAutoResize");
}).mouseleave(function(J){$(this).width(A.width).height(A.height).removeClass("exhibitDataEditAutoResize");
}).css("position","Absolute").css("top","0px").css("left","0px");
if(A.width<=0){A.width=10;
D.width(A.width);
}if(A.height<=0){A.height=10;
D.height(A.height);
}$(C).replaceWith(D);
}else{$(C).replaceWith(E);
}}else{$(C).replaceWith('<span style="color:Red;">Failed to initalise</span>');
}};
Exhibit.DataEdit.Editor.prototype._inside=function(F){if(!this._clickEvent){return false;
}var B=$(F);
var E=B.offset().left;
var D=B.offset().top;
var A=B.width();
var C=B.height();
return((this._clickEvent.pageX>=E)&&(this._clickEvent.pageY>=D)&&(this._clickEvent.pageX<E+A)&&(this._clickEvent.pageY<D+C));
};
Exhibit.DataEdit.Editor._uniqueObjects=function(F,A){var B=[];
var G=database.getAllItems().toArray();
for(var C=0;
C<G.length;
C++){var D=database.getItem(G[C]);
if(D.type!=F){continue;
}database.getObjects(D.id,A).visit(function(H){B[H]=true;
});
}var E=[];
for(var C in B){E.push(C);
}return E.sort();
};
Exhibit.DataEdit.Editor._parseTrueFalse=function(A,B){B=(B==undefined)?false:B;
if(!A){return B;
}A=A.toLowerCase();
return(A==="true"||A==="yes");
};
Exhibit.DataEdit.Editor._parseDisabledFor=function(E){var C={edit:true,add:true};
if(E){var A=E.split(",");
for(var D=0;
D<A.length;
D++){var B=A[D].toLowerCase();
if(B=="edit"||B=="all"){C.edit=true;
}else{if(B=="add"||B=="all"){C.add=true;
}}}}return C;
};
Exhibit.DataEdit.Editor._htmlTag=function(H,A,D,C){for(var E=0;
E<D.attributes.length;
E++){var G=D.attributes[E].name;
var B=D.attributes[E].value;
if((D.attributes[E].specified!=undefined)&&!D.attributes[E].specified){continue;
}if(A[G]==undefined){A[G]=B;
}}var F="<"+H;
for(k in A){if(A[k]){F=F+" "+k+'="'+A[k]+'"';
}}F=F+((C)?"/>":">");
return F;
};
Exhibit.DataEdit.Editor._extractStyle=function(E){var D=["font-family","font-size","font-weight","font-style","text-transform","text-decoration","letter-spacing","word-spacing","line-height","text-align","vertical-align","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"];
var C="";
for(var B=0;
B<D.length;
B++){var A=$(E).css(D[B])+"";
if(A){A=A.replace(/["|']/gi,"");
C=C+D[B]+":"+A+"; ";
}}return C;
};
Exhibit.DataEdit.Editor._getColRowDimensions=function(E,D,C){var A=0,B=0;
if(("canHaveHTML" in E)&&!E.canHaveHMTL){A=10;
B=12;
}else{$(E).prepend('<span id="__SIZE_GUESSER__">M</span>');
A=$("#__SIZE_GUESSER__",E).width();
B=$("#__SIZE_GUESSER__",E).height();
$("#__SIZE_GUESSER__",E).remove();
}return{width:(D*A),height:(C*B)};
};
Exhibit.DataEdit.Editor._uid=(new Date).getTime();
Exhibit.DataEdit.Editor._getUID=function(){Exhibit.DataEdit.Editor._uid++;
return Exhibit.DataEdit.Editor._uid;
};
Exhibit.DataEdit.Editor._escapeString=function(C){var B="";
for(var A=0;
A<C.length;
A++){var E=C.charCodeAt(A);
var D=((E>=97&&E<=122)||(E>=65&&E<=90));
if(D){B=B+C.charAt(A);
}else{B=B+((E<16)?"0":"")+E.toString(16);
}}return B;
};
Exhibit.DataEdit.Editor.matchExactStringFromList=function(D,C){var B=D.toLowerCase();
for(var A=0;
A<C.length;
A++){if(B===C[A].toLowerCase()){return C[A];
}}return null;
};
Exhibit.DataEdit.Editor.matchClosestStringFromList=function(H,G){var E=H.toLowerCase();
var F=9999;
var C=-1;
for(var D=0;
D<G.length;
D++){var B=G[D].substring(0,E.length).toLowerCase();
var A=Exhibit.DataEdit.Editor._levenshteinDistance(E,B);
if(A<F){F=A;
C=D;
}}if(C!=-1){return G[C];
}else{return null;
}};
Exhibit.DataEdit.Editor._levenshteinDistance=function(I,H){if(I.length<H.length){var J=I;
I=H;
H=J;
}var E=I.length;
var D=H.length;
var A=new Array();
A[0]=new Array();
for(var F=0;
F<E+1;
F++){A[0][F]=F;
}var G=function(M,L,K){if(M<L&&M<K){return M;
}else{if(L<M&&L<K){return L;
}else{return K;
}}};
for(var F=1;
F<E+1;
F++){A[F]=new Array();
A[F][0]=F;
for(var C=1;
C<D+1;
C++){var B=(I.charAt(F-1)==H.charAt(C-1))?0:1;
A[F][C]=G(A[F-1][C]+1,A[F][C-1]+1,A[F-1][C-1]+B);
}}return A[E][D];
};
Exhibit.DataEdit.Editor.prototype.getFields=function(){return this._fields;
};
Exhibit.DataEdit.Editor.prototype.log=function(){if(window["console"]&&Exhibit.DataEdit.Editor._DEBUG_){console.log.apply(this,arguments);
}};


/* enum-field.js */
Exhibit.DataEdit.Editor.EnumField=function(G,E,B,F,D){this._jqThis=G;
this._itemId=E;
this._propId=B;
this._value=F;
this._divId="__DATAEDITOR__"+this._propId+"_"+Exhibit.DataEdit.Editor._getUID();
this._validators=$(G).attr("ex:validators");
this._disabledFor=Exhibit.DataEdit.Editor._parseDisabledFor($(G).attr("ex:disableFor"));
this._noEditorLens=D;
this._matchDisplayLens=Exhibit.DataEdit.Editor._parseTrueFalse($(G).attr("ex:useDisplayStyle"));
this._saveOnChange=false;
this._options=[];
this._allowNew=Exhibit.DataEdit.Editor._parseTrueFalse($(G).attr("ex:allowNew"),true);
var A=this;
$("option",this._jqThis).each(function(H){A._options.push($(this).attr("value"));
});
if(this._options.length==0){var C=database.getObject(this._itemId,"type");
this._options=Exhibit.DataEdit.Editor._uniqueObjects(C,this._propId);
}if(this._value==undefined){this._value=(this._options.length>0)?this._options[0]:"";
}if((typeof this._value)!="string"){throw"Invalid data for EnumField";
}};
Exhibit.DataEdit.Editor.EnumField.prototype.getHTML=function(D){var B=this;
D.push(function(){var E=$("#"+B._divId);
E.bind("blur",function(F){B.setValue(B.getValue());
});
E.autocomplete({source:B._options});
if(this._saveOnChange){E.bind("change",function(F){Exhibit.DataEdit.onChange(B._itemId,B._propId);
});
}});
var C=null;
if(this._noEditorLens||this._matchDisplayLens){C=Exhibit.DataEdit.Editor._extractStyle(this._jqThis)+"border-width: 0px; width: "+$(this._jqThis).width()+"px; height: "+$(this._jqThis).height()+"px; ";
}var A=Exhibit.DataEdit.Editor._htmlTag("input",{"id":this._divId,"style":C,"class":"exhibitDataEditEnumField","value":this._value},$(this._jqThis).get()[0],true);
return A;
};
Exhibit.DataEdit.Editor.EnumField.prototype.getValue=function(){var A=$("#"+this._divId).get();
if(A.length){var B=A[0].value;
if(B.length>0){var C=Exhibit.DataEdit.Editor.matchExactStringFromList(B,this._options);
if(C!=null){return C;
}else{if(this._allowNew){return B;
}else{C=Exhibit.DataEdit.Editor.matchClosestStringFromList(B,this._options);
if(C){return C;
}}}}}return null;
};
Exhibit.DataEdit.Editor.EnumField.prototype.setValue=function(A){var B=$("#"+this._divId).get();
if(B.length){B[0].value=A;
}};
Exhibit.DataEdit.Editor.EnumField.prototype.setError=function(A){$("#"+this._divId).css("background-color",A?Exhibit.DataEdit.Editor._ERRCOL_:Exhibit.DataEdit.Editor._BGCOL_);
};
Exhibit.DataEdit.Editor.EnumField.prototype.focus=function(){};
Exhibit.DataEdit.Editor.EnumField.domFilter=function(A,B){$("select",A).filter(function(C){return $(this).attr("ex:type")=="enum";
}).each(B);
};


/* jquery-ui-1.8.16.custom.min.js */
(function(D,C){function B(F,E){var G=F.nodeName.toLowerCase();
if("area"===G){E=F.parentNode;
G=E.name;
if(!F.href||!G||E.nodeName.toLowerCase()!=="map"){return false;
}F=D("img[usemap=#"+G+"]")[0];
return !!F&&A(F);
}return(/input|select|textarea|button|object/.test(G)?!F.disabled:"a"==G?F.href||E:E)&&A(F);
}function A(E){return !D(E).parents().andSelf().filter(function(){return D.curCSS(this,"visibility")==="hidden"||D.expr.filters.hidden(this);
}).length;
}D.ui=D.ui||{};
if(!D.ui.version){D.extend(D.ui,{version:"1.8.16",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});
D.fn.extend({propAttr:D.fn.prop||D.fn.attr,_focus:D.fn.focus,focus:function(F,E){return typeof F==="number"?this.each(function(){var G=this;
setTimeout(function(){D(G).focus();
E&&E.call(G);
},F);
}):this._focus.apply(this,arguments);
},scrollParent:function(){var E;
E=D.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(D.curCSS(this,"position",1))&&/(auto|scroll)/.test(D.curCSS(this,"overflow",1)+D.curCSS(this,"overflow-y",1)+D.curCSS(this,"overflow-x",1));
}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(D.curCSS(this,"overflow",1)+D.curCSS(this,"overflow-y",1)+D.curCSS(this,"overflow-x",1));
}).eq(0);
return/fixed/.test(this.css("position"))||!E.length?D(document):E;
},zIndex:function(F){if(F!==C){return this.css("zIndex",F);
}if(this.length){F=D(this[0]);
for(var E;
F.length&&F[0]!==document;
){E=F.css("position");
if(E==="absolute"||E==="relative"||E==="fixed"){E=parseInt(F.css("zIndex"),10);
if(!isNaN(E)&&E!==0){return E;
}}F=F.parent();
}}return 0;
},disableSelection:function(){return this.bind((D.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(E){E.preventDefault();
});
},enableSelection:function(){return this.unbind(".ui-disableSelection");
}});
D.each(["Width","Height"],function(F,E){function J(M,L,K,N){D.each(I,function(){L-=parseFloat(D.curCSS(M,"padding"+this,true))||0;
if(K){L-=parseFloat(D.curCSS(M,"border"+this+"Width",true))||0;
}if(N){L-=parseFloat(D.curCSS(M,"margin"+this,true))||0;
}});
return L;
}var I=E==="Width"?["Left","Right"]:["Top","Bottom"],H=E.toLowerCase(),G={innerWidth:D.fn.innerWidth,innerHeight:D.fn.innerHeight,outerWidth:D.fn.outerWidth,outerHeight:D.fn.outerHeight};
D.fn["inner"+E]=function(K){if(K===C){return G["inner"+E].call(this);
}return this.each(function(){D(this).css(H,J(this,K)+"px");
});
};
D.fn["outer"+E]=function(L,K){if(typeof L!=="number"){return G["outer"+E].call(this,L);
}return this.each(function(){D(this).css(H,J(this,L,true,K)+"px");
});
};
});
D.extend(D.expr[":"],{data:function(F,E,G){return !!D.data(F,G[3]);
},focusable:function(E){return B(E,!isNaN(D.attr(E,"tabindex")));
},tabbable:function(F){var E=D.attr(F,"tabindex"),G=isNaN(E);
return(G||E>=0)&&B(F,!G);
}});
D(function(){var F=document.body,E=F.appendChild(E=document.createElement("div"));
D.extend(E.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});
D.support.minHeight=E.offsetHeight===100;
D.support.selectstart="onselectstart" in E;
F.removeChild(E).style.display="none";
});
D.extend(D.ui,{plugin:{add:function(F,E,H){F=D.ui[F].prototype;
for(var G in H){F.plugins[G]=F.plugins[G]||[];
F.plugins[G].push([E,H[G]]);
}},call:function(F,E,H){if((E=F.plugins[E])&&F.element[0].parentNode){for(var G=0;
G<E.length;
G++){F.options[E[G][0]]&&E[G][1].apply(F.element,H);
}}}},contains:function(F,E){return document.compareDocumentPosition?F.compareDocumentPosition(E)&16:F!==E&&F.contains(E);
},hasScroll:function(F,E){if(D(F).css("overflow")==="hidden"){return false;
}E=E&&E==="left"?"scrollLeft":"scrollTop";
var G=false;
if(F[E]>0){return true;
}F[E]=1;
G=F[E]>0;
F[E]=0;
return G;
},isOverAxis:function(F,E,G){return F>E&&F<E+G;
},isOver:function(F,E,J,I,H,G){return D.ui.isOverAxis(F,J,H)&&D.ui.isOverAxis(E,I,G);
}});
}})(jQuery);
(function(A,D){if(A.cleanData){var C=A.cleanData;
A.cleanData=function(E){for(var H=0,G;
(G=E[H])!=null;
H++){try{A(G).triggerHandler("remove");
}catch(F){}}C(E);
};
}else{var B=A.fn.remove;
A.fn.remove=function(E,F){return this.each(function(){if(!F){if(!E||A.filter(E,[this]).length){A("*",this).add([this]).each(function(){try{A(this).triggerHandler("remove");
}catch(G){}});
}}return B.call(A(this),E,F);
});
};
}A.widget=function(E,I,H){var G=E.split(".")[0],F;
E=E.split(".")[1];
F=G+"-"+E;
if(!H){H=I;
I=A.Widget;
}A.expr[":"][F]=function(J){return !!A.data(J,E);
};
A[G]=A[G]||{};
A[G][E]=function(J,K){arguments.length&&this._createWidget(J,K);
};
I=new I;
I.options=A.extend(true,{},I.options);
A[G][E].prototype=A.extend(true,I,{namespace:G,widgetName:E,widgetEventPrefix:A[G][E].prototype.widgetEventPrefix||E,widgetBaseClass:F},H);
A.widget.bridge(E,A[G][E]);
};
A.widget.bridge=function(E,F){A.fn[E]=function(J){var I=typeof J==="string",H=Array.prototype.slice.call(arguments,1),G=this;
J=!I&&H.length?A.extend.apply(null,[true,J].concat(H)):J;
if(I&&J.charAt(0)==="_"){return G;
}I?this.each(function(){var L=A.data(this,E),K=L&&A.isFunction(L[J])?L[J].apply(L,H):L;
if(K!==L&&K!==D){G=K;
return false;
}}):this.each(function(){var K=A.data(this,E);
K?K.option(J||{})._init():A.data(this,E,new F(J,this));
});
return G;
};
};
A.Widget=function(E,F){arguments.length&&this._createWidget(E,F);
};
A.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(E,G){A.data(G,this.widgetName,this);
this.element=A(G);
this.options=A.extend(true,{},this.options,this._getCreateOptions(),E);
var F=this;
this.element.bind("remove."+this.widgetName,function(){F.destroy();
});
this._create();
this._trigger("create");
this._init();
},_getCreateOptions:function(){return A.metadata&&A.metadata.get(this.element[0])[this.widgetName];
},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);
this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");
},widget:function(){return this.element;
},option:function(E,G){var F=E;
if(arguments.length===0){return A.extend({},this.options);
}if(typeof E==="string"){if(G===D){return this.options[E];
}F={};
F[E]=G;
}this._setOptions(F);
return this;
},_setOptions:function(E){var F=this;
A.each(E,function(H,G){F._setOption(H,G);
});
return this;
},_setOption:function(E,F){this.options[E]=F;
if(E==="disabled"){this.widget()[F?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",F);
}return this;
},enable:function(){return this._setOption("disabled",false);
},disable:function(){return this._setOption("disabled",true);
},_trigger:function(E,I,H){var G=this.options[E];
I=A.Event(I);
I.type=(E===this.widgetEventPrefix?E:this.widgetEventPrefix+E).toLowerCase();
H=H||{};
if(I.originalEvent){E=A.event.props.length;
for(var F;
E;
){F=A.event.props[--E];
I[F]=I.originalEvent[F];
}}this.element.trigger(I,H);
return !(A.isFunction(G)&&G.call(this.element[0],I,H)===false||I.isDefaultPrevented());
}};
})(jQuery);
(function(E){E.ui=E.ui||{};
var D=/left|center|right/,C=/top|center|bottom/,B=E.fn.position,A=E.fn.offset;
E.fn.position=function(F){if(!F||!F.of){return B.apply(this,arguments);
}F=E.extend({},F);
var G=E(F.of),M=G[0],K=(F.collision||"flip").split(" "),L=F.offset?F.offset.split(" "):[0,0],J,H,I;
if(M.nodeType===9){J=G.width();
H=G.height();
I={top:0,left:0};
}else{if(M.setTimeout){J=G.width();
H=G.height();
I={top:G.scrollTop(),left:G.scrollLeft()};
}else{if(M.preventDefault){F.at="left top";
J=H=0;
I={top:F.of.pageY,left:F.of.pageX};
}else{J=G.outerWidth();
H=G.outerHeight();
I=G.offset();
}}}E.each(["my","at"],function(){var N=(F[this]||"").split(" ");
if(N.length===1){N=D.test(N[0])?N.concat(["center"]):C.test(N[0])?["center"].concat(N):["center","center"];
}N[0]=D.test(N[0])?N[0]:"center";
N[1]=C.test(N[1])?N[1]:"center";
F[this]=N;
});
if(K.length===1){K[1]=K[0];
}L[0]=parseInt(L[0],10)||0;
if(L.length===1){L[1]=L[0];
}L[1]=parseInt(L[1],10)||0;
if(F.at[0]==="right"){I.left+=J;
}else{if(F.at[0]==="center"){I.left+=J/2;
}}if(F.at[1]==="bottom"){I.top+=H;
}else{if(F.at[1]==="center"){I.top+=H/2;
}}I.left+=L[0];
I.top+=L[1];
return this.each(function(){var T=E(this),R=T.outerWidth(),Q=T.outerHeight(),P=parseInt(E.curCSS(this,"marginLeft",true))||0,O=parseInt(E.curCSS(this,"marginTop",true))||0,V=R+P+(parseInt(E.curCSS(this,"marginRight",true))||0),U=Q+O+(parseInt(E.curCSS(this,"marginBottom",true))||0),S=E.extend({},I),N;
if(F.my[0]==="right"){S.left-=R;
}else{if(F.my[0]==="center"){S.left-=R/2;
}}if(F.my[1]==="bottom"){S.top-=Q;
}else{if(F.my[1]==="center"){S.top-=Q/2;
}}S.left=Math.round(S.left);
S.top=Math.round(S.top);
N={left:S.left-P,top:S.top-O};
E.each(["left","top"],function(X,W){E.ui.position[K[X]]&&E.ui.position[K[X]][W](S,{targetWidth:J,targetHeight:H,elemWidth:R,elemHeight:Q,collisionPosition:N,collisionWidth:V,collisionHeight:U,offset:L,my:F.my,at:F.at});
});
E.fn.bgiframe&&T.bgiframe();
T.offset(E.extend(S,{using:F.using}));
});
};
E.ui.position={fit:{left:function(F,G){var H=E(window);
H=G.collisionPosition.left+G.collisionWidth-H.width()-H.scrollLeft();
F.left=H>0?F.left-H:Math.max(F.left-G.collisionPosition.left,F.left);
},top:function(F,G){var H=E(window);
H=G.collisionPosition.top+G.collisionHeight-H.height()-H.scrollTop();
F.top=H>0?F.top-H:Math.max(F.top-G.collisionPosition.top,F.top);
}},flip:{left:function(F,G){if(G.at[0]!=="center"){var K=E(window);
K=G.collisionPosition.left+G.collisionWidth-K.width()-K.scrollLeft();
var I=G.my[0]==="left"?-G.elemWidth:G.my[0]==="right"?G.elemWidth:0,J=G.at[0]==="left"?G.targetWidth:-G.targetWidth,H=-2*G.offset[0];
F.left+=G.collisionPosition.left<0?I+J+H:K>0?I+J+H:0;
}},top:function(F,G){if(G.at[1]!=="center"){var K=E(window);
K=G.collisionPosition.top+G.collisionHeight-K.height()-K.scrollTop();
var I=G.my[1]==="top"?-G.elemHeight:G.my[1]==="bottom"?G.elemHeight:0,J=G.at[1]==="top"?G.targetHeight:-G.targetHeight,H=-2*G.offset[1];
F.top+=G.collisionPosition.top<0?I+J+H:K>0?I+J+H:0;
}}}};
if(!E.offset.setOffset){E.offset.setOffset=function(F,G){if(/static/.test(E.curCSS(F,"position"))){F.style.position="relative";
}var K=E(F),I=K.offset(),J=parseInt(E.curCSS(F,"top",true),10)||0,H=parseInt(E.curCSS(F,"left",true),10)||0;
I={top:G.top-I.top+J,left:G.left-I.left+H};
"using" in G?G.using.call(F,I):K.css(I);
};
E.fn.offset=function(F){var G=this[0];
if(!G||!G.ownerDocument){return null;
}if(F){return this.each(function(){E.offset.setOffset(this,F);
});
}return A.call(this);
};
}})(jQuery);
(function(B){var A=0;
B.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var D=this,C=this.element[0].ownerDocument,E;
this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(G){if(!(D.options.disabled||D.element.propAttr("readOnly"))){E=false;
var F=B.ui.keyCode;
switch(G.keyCode){case F.PAGE_UP:D._move("previousPage",G);
break;
case F.PAGE_DOWN:D._move("nextPage",G);
break;
case F.UP:D._move("previous",G);
G.preventDefault();
break;
case F.DOWN:D._move("next",G);
G.preventDefault();
break;
case F.ENTER:case F.NUMPAD_ENTER:if(D.menu.active){E=true;
G.preventDefault();
}case F.TAB:if(!D.menu.active){return ;
}D.menu.select(G);
break;
case F.ESCAPE:D.element.val(D.term);
D.close(G);
break;
default:clearTimeout(D.searching);
D.searching=setTimeout(function(){if(D.term!=D.element.val()){D.selectedItem=null;
D.search(null,G);
}},D.options.delay);
break;
}}}).bind("keypress.autocomplete",function(F){if(E){E=false;
F.preventDefault();
}}).bind("focus.autocomplete",function(){if(!D.options.disabled){D.selectedItem=null;
D.previous=D.element.val();
}}).bind("blur.autocomplete",function(F){if(!D.options.disabled){clearTimeout(D.searching);
D.closing=setTimeout(function(){D.close(F);
D._change(F);
},150);
}});
this._initSource();
this.response=function(){return D._response.apply(D,arguments);
};
this.menu=B("<ul></ul>").addClass("ui-autocomplete").appendTo(B(this.options.appendTo||"body",C)[0]).mousedown(function(G){var F=D.menu.element[0];
B(G.target).closest(".ui-menu-item").length||setTimeout(function(){B(document).one("mousedown",function(H){H.target!==D.element[0]&&H.target!==F&&!B.ui.contains(F,H.target)&&D.close();
});
},1);
setTimeout(function(){clearTimeout(D.closing);
},13);
}).menu({focus:function(G,F){F=F.item.data("item.autocomplete");
false!==D._trigger("focus",G,{item:F})&&/^key/.test(G.originalEvent.type)&&D.element.val(F.value);
},selected:function(I,H){var G=H.item.data("item.autocomplete"),F=D.previous;
if(D.element[0]!==C.activeElement){D.element.focus();
D.previous=F;
setTimeout(function(){D.previous=F;
D.selectedItem=G;
},1);
}false!==D._trigger("select",I,{item:G})&&D.element.val(G.value);
D.term=D.element.val();
D.close(I);
D.selectedItem=G;
},blur:function(){D.menu.element.is(":visible")&&D.element.val()!==D.term&&D.element.val(D.term);
}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");
B.fn.bgiframe&&this.menu.element.bgiframe();
},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");
this.menu.element.remove();
B.Widget.prototype.destroy.call(this);
},_setOption:function(D,C){B.Widget.prototype._setOption.apply(this,arguments);
D==="source"&&this._initSource();
if(D==="appendTo"){this.menu.element.appendTo(B(C||"body",this.element[0].ownerDocument)[0]);
}D==="disabled"&&C&&this.xhr&&this.xhr.abort();
},_initSource:function(){var D=this,C,E;
if(B.isArray(this.options.source)){C=this.options.source;
this.source=function(G,F){F(B.ui.autocomplete.filter(C,G.term));
};
}else{if(typeof this.options.source==="string"){E=this.options.source;
this.source=function(G,F){D.xhr&&D.xhr.abort();
D.xhr=B.ajax({url:E,data:G,dataType:"json",autocompleteRequest:++A,success:function(H){this.autocompleteRequest===A&&F(H);
},error:function(){this.autocompleteRequest===A&&F([]);
}});
};
}else{this.source=this.options.source;
}}},search:function(D,C){D=D!=null?D:this.element.val();
this.term=this.element.val();
if(D.length<this.options.minLength){return this.close(C);
}clearTimeout(this.closing);
if(this._trigger("search",C)!==false){return this._search(D);
}},_search:function(C){this.pending++;
this.element.addClass("ui-autocomplete-loading");
this.source({term:C},this.response);
},_response:function(C){if(!this.options.disabled&&C&&C.length){C=this._normalize(C);
this._suggest(C);
this._trigger("open");
}else{this.close();
}this.pending--;
this.pending||this.element.removeClass("ui-autocomplete-loading");
},close:function(C){clearTimeout(this.closing);
if(this.menu.element.is(":visible")){this.menu.element.hide();
this.menu.deactivate();
this._trigger("close",C);
}},_change:function(C){this.previous!==this.element.val()&&this._trigger("change",C,{item:this.selectedItem});
},_normalize:function(C){if(C.length&&C[0].label&&C[0].value){return C;
}return B.map(C,function(D){if(typeof D==="string"){return{label:D,value:D};
}return B.extend({label:D.label||D.value,value:D.value||D.label},D);
});
},_suggest:function(D){var C=this.menu.element.empty().zIndex(this.element.zIndex()+1);
this._renderMenu(C,D);
this.menu.deactivate();
this.menu.refresh();
C.show();
this._resizeMenu();
C.position(B.extend({of:this.element},this.options.position));
this.options.autoFocus&&this.menu.next(new B.Event("mouseover"));
},_resizeMenu:function(){var C=this.menu.element;
C.outerWidth(Math.max(C.width("").outerWidth(),this.element.outerWidth()));
},_renderMenu:function(D,C){var E=this;
B.each(C,function(G,F){E._renderItem(D,F);
});
},_renderItem:function(D,C){return B("<li></li>").data("item.autocomplete",C).append(B("<a></a>").text(C.label)).appendTo(D);
},_move:function(D,C){if(this.menu.element.is(":visible")){if(this.menu.first()&&/^previous/.test(D)||this.menu.last()&&/^next/.test(D)){this.element.val(this.term);
this.menu.deactivate();
}else{this.menu[D](C);
}}else{this.search(null,C);
}},widget:function(){return this.menu.element;
}});
B.extend(B.ui.autocomplete,{escapeRegex:function(C){return C.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");
},filter:function(D,C){var E=new RegExp(B.ui.autocomplete.escapeRegex(C),"i");
return B.grep(D,function(F){return E.test(F.label||F.value||F);
});
}});
})(jQuery);
(function(A){A.widget("ui.menu",{_create:function(){var B=this;
this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(C){if(A(C.target).closest(".ui-menu-item a").length){C.preventDefault();
B.select(C);
}});
this.refresh();
},refresh:function(){var B=this;
this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(C){B.activate(C,A(this).parent());
}).mouseleave(function(){B.deactivate();
});
},activate:function(E,C){this.deactivate();
if(this.hasScroll()){var B=C.offset().top-this.element.offset().top,D=this.element.scrollTop(),F=this.element.height();
if(B<0){this.element.scrollTop(D+B);
}else{B>=F&&this.element.scrollTop(D+B-F+C.height());
}}this.active=C.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();
this._trigger("focus",E,{item:C});
},deactivate:function(){if(this.active){this.active.children("a").removeClass("ui-state-hover").removeAttr("id");
this._trigger("blur");
this.active=null;
}},next:function(B){this.move("next",".ui-menu-item:first",B);
},previous:function(B){this.move("prev",".ui-menu-item:last",B);
},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;
},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;
},move:function(D,C,B){if(this.active){D=this.active[D+"All"](".ui-menu-item").eq(0);
D.length?this.activate(B,D):this.activate(B,this.element.children(C));
}else{this.activate(B,this.element.children(C));
}},nextPage:function(E){if(this.hasScroll()){if(!this.active||this.last()){this.activate(E,this.element.children(".ui-menu-item:first"));
}else{var C=this.active.offset().top,B=this.element.height(),D=this.element.children(".ui-menu-item").filter(function(){var F=A(this).offset().top-C-B+A(this).height();
return F<10&&F>-10;
});
D.length||(D=this.element.children(".ui-menu-item:last"));
this.activate(E,D);
}}else{this.activate(E,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"));
}},previousPage:function(D){if(this.hasScroll()){if(!this.active||this.first()){this.activate(D,this.element.children(".ui-menu-item:last"));
}else{var C=this.active.offset().top,B=this.element.height();
result=this.element.children(".ui-menu-item").filter(function(){var E=A(this).offset().top-C+B-A(this).height();
return E<10&&E>-10;
});
result.length||(result=this.element.children(".ui-menu-item:first"));
this.activate(D,result);
}}else{this.activate(D,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"));
}},hasScroll:function(){return this.element.height()<this.element[A.fn.prop?"prop":"attr"]("scrollHeight");
},select:function(B){this._trigger("selected",B,{item:this.active});
}});
})(jQuery);
(function(E,B){var A={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},D={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},C=E.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};
E.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",collision:"fit",using:function(G){var F=E(this).css(G).offset().top;
F<0&&E(this).css("top",G.top-F);
}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");
if(typeof this.originalTitle!=="string"){this.originalTitle="";
}this.options.title=this.options.title||this.originalTitle;
var G=this,F=G.options,L=F.title||"&#160;",K=E.ui.dialog.getTitleId(G.element),I=(G.uiDialog=E("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+F.dialogClass).css({zIndex:F.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(M){if(F.closeOnEscape&&!M.isDefaultPrevented()&&M.keyCode&&M.keyCode===E.ui.keyCode.ESCAPE){G.close(M);
M.preventDefault();
}}).attr({role:"dialog","aria-labelledby":K}).mousedown(function(M){G.moveToTop(false,M);
});
G.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(I);
var J=(G.uiDialogTitlebar=E("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(I),H=E('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){H.addClass("ui-state-hover");
},function(){H.removeClass("ui-state-hover");
}).focus(function(){H.addClass("ui-state-focus");
}).blur(function(){H.removeClass("ui-state-focus");
}).click(function(M){G.close(M);
return false;
}).appendTo(J);
(G.uiDialogTitlebarCloseText=E("<span></span>")).addClass("ui-icon ui-icon-closethick").text(F.closeText).appendTo(H);
E("<span></span>").addClass("ui-dialog-title").attr("id",K).html(L).prependTo(J);
if(E.isFunction(F.beforeclose)&&!E.isFunction(F.beforeClose)){F.beforeClose=F.beforeclose;
}J.find("*").add(J).disableSelection();
F.draggable&&E.fn.draggable&&G._makeDraggable();
F.resizable&&E.fn.resizable&&G._makeResizable();
G._createButtons(F.buttons);
G._isOpen=false;
E.fn.bgiframe&&I.bgiframe();
},_init:function(){this.options.autoOpen&&this.open();
},destroy:function(){var F=this;
F.overlay&&F.overlay.destroy();
F.uiDialog.hide();
F.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");
F.uiDialog.remove();
F.originalTitle&&F.element.attr("title",F.originalTitle);
return F;
},widget:function(){return this.uiDialog;
},close:function(G){var F=this,I,H;
if(false!==F._trigger("beforeClose",G)){F.overlay&&F.overlay.destroy();
F.uiDialog.unbind("keypress.ui-dialog");
F._isOpen=false;
if(F.options.hide){F.uiDialog.hide(F.options.hide,function(){F._trigger("close",G);
});
}else{F.uiDialog.hide();
F._trigger("close",G);
}E.ui.dialog.overlay.resize();
if(F.options.modal){I=0;
E(".ui-dialog").each(function(){if(this!==F.uiDialog[0]){H=E(this).css("z-index");
isNaN(H)||(I=Math.max(I,H));
}});
E.ui.dialog.maxZ=I;
}return F;
}},isOpen:function(){return this._isOpen;
},moveToTop:function(G,F){var I=this,H=I.options;
if(H.modal&&!G||!H.stack&&!H.modal){return I._trigger("focus",F);
}if(H.zIndex>E.ui.dialog.maxZ){E.ui.dialog.maxZ=H.zIndex;
}if(I.overlay){E.ui.dialog.maxZ+=1;
I.overlay.$el.css("z-index",E.ui.dialog.overlay.maxZ=E.ui.dialog.maxZ);
}G={scrollTop:I.element.scrollTop(),scrollLeft:I.element.scrollLeft()};
E.ui.dialog.maxZ+=1;
I.uiDialog.css("z-index",E.ui.dialog.maxZ);
I.element.attr(G);
I._trigger("focus",F);
return I;
},open:function(){if(!this._isOpen){var G=this,F=G.options,H=G.uiDialog;
G.overlay=F.modal?new E.ui.dialog.overlay(G):null;
G._size();
G._position(F.position);
H.show(F.show);
G.moveToTop(true);
F.modal&&H.bind("keypress.ui-dialog",function(K){if(K.keyCode===E.ui.keyCode.TAB){var I=E(":tabbable",this),J=I.filter(":first");
I=I.filter(":last");
if(K.target===I[0]&&!K.shiftKey){J.focus(1);
return false;
}else{if(K.target===J[0]&&K.shiftKey){I.focus(1);
return false;
}}}});
E(G.element.find(":tabbable").get().concat(H.find(".ui-dialog-buttonpane :tabbable").get().concat(H.get()))).eq(0).focus();
G._isOpen=true;
G._trigger("open");
return G;
}},_createButtons:function(G){var F=this,J=false,I=E("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),H=E("<div></div>").addClass("ui-dialog-buttonset").appendTo(I);
F.uiDialog.find(".ui-dialog-buttonpane").remove();
typeof G==="object"&&G!==null&&E.each(G,function(){return !(J=true);
});
if(J){E.each(G,function(M,L){L=E.isFunction(L)?{click:L,text:M}:L;
var K=E('<button type="button"></button>').click(function(){L.click.apply(F.element[0],arguments);
}).appendTo(H);
E.each(L,function(O,N){if(O!=="click"){O in C?K[O](N):K.attr(O,N);
}});
E.fn.button&&K.button();
});
I.appendTo(F.uiDialog);
}},_makeDraggable:function(){function G(K){return{position:K.position,offset:K.offset};
}var F=this,J=F.options,I=E(document),H;
F.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(L,K){H=J.height==="auto"?"auto":E(this).height();
E(this).height(E(this).height()).addClass("ui-dialog-dragging");
F._trigger("dragStart",L,G(K));
},drag:function(L,K){F._trigger("drag",L,G(K));
},stop:function(L,K){J.position=[K.position.left-I.scrollLeft(),K.position.top-I.scrollTop()];
E(this).removeClass("ui-dialog-dragging").height(H);
F._trigger("dragStop",L,G(K));
E.ui.dialog.overlay.resize();
}});
},_makeResizable:function(G){function F(K){return{originalPosition:K.originalPosition,originalSize:K.originalSize,position:K.position,size:K.size};
}G=G===B?this.options.resizable:G;
var J=this,I=J.options,H=J.uiDialog.css("position");
G=typeof G==="string"?G:"n,e,s,w,se,sw,ne,nw";
J.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:J.element,maxWidth:I.maxWidth,maxHeight:I.maxHeight,minWidth:I.minWidth,minHeight:J._minHeight(),handles:G,start:function(L,K){E(this).addClass("ui-dialog-resizing");
J._trigger("resizeStart",L,F(K));
},resize:function(L,K){J._trigger("resize",L,F(K));
},stop:function(L,K){E(this).removeClass("ui-dialog-resizing");
I.height=E(this).height();
I.width=E(this).width();
J._trigger("resizeStop",L,F(K));
E.ui.dialog.overlay.resize();
}}).css("position",H).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");
},_minHeight:function(){var F=this.options;
return F.height==="auto"?F.minHeight:Math.min(F.minHeight,F.height);
},_position:function(G){var F=[],I=[0,0],H;
if(G){if(typeof G==="string"||typeof G==="object"&&"0" in G){F=G.split?G.split(" "):[G[0],G[1]];
if(F.length===1){F[1]=F[0];
}E.each(["left","top"],function(J,K){if(+F[J]===F[J]){I[J]=F[J];
F[J]=K;
}});
G={my:F.join(" "),at:F.join(" "),offset:I.join(" ")};
}G=E.extend({},E.ui.dialog.prototype.options.position,G);
}else{G=E.ui.dialog.prototype.options.position;
}(H=this.uiDialog.is(":visible"))||this.uiDialog.show();
this.uiDialog.css({top:0,left:0}).position(E.extend({of:window},G));
H||this.uiDialog.hide();
},_setOptions:function(G){var F=this,I={},H=false;
E.each(G,function(J,K){F._setOption(J,K);
if(J in A){H=true;
}if(J in D){I[J]=K;
}});
H&&this._size();
this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",I);
},_setOption:function(G,F){var J=this,I=J.uiDialog;
switch(G){case"beforeclose":G="beforeClose";
break;
case"buttons":J._createButtons(F);
break;
case"closeText":J.uiDialogTitlebarCloseText.text(""+F);
break;
case"dialogClass":I.removeClass(J.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+F);
break;
case"disabled":F?I.addClass("ui-dialog-disabled"):I.removeClass("ui-dialog-disabled");
break;
case"draggable":var H=I.is(":data(draggable)");
H&&!F&&I.draggable("destroy");
!H&&F&&J._makeDraggable();
break;
case"position":J._position(F);
break;
case"resizable":(H=I.is(":data(resizable)"))&&!F&&I.resizable("destroy");
H&&typeof F==="string"&&I.resizable("option","handles",F);
!H&&F!==false&&J._makeResizable(F);
break;
case"title":E(".ui-dialog-title",J.uiDialogTitlebar).html(""+(F||"&#160;"));
break;
}E.Widget.prototype._setOption.apply(J,arguments);
},_size:function(){var G=this.options,F,I,H=this.uiDialog.is(":visible");
this.element.show().css({width:"auto",minHeight:0,height:0});
if(G.minWidth>G.width){G.width=G.minWidth;
}F=this.uiDialog.css({height:"auto",width:G.width}).height();
I=Math.max(0,G.minHeight-F);
if(G.height==="auto"){if(E.support.minHeight){this.element.css({minHeight:I,height:"auto"});
}else{this.uiDialog.show();
G=this.element.css("height","auto").height();
H||this.uiDialog.hide();
this.element.height(Math.max(G,I));
}}else{this.element.height(Math.max(G.height-F,0));
}this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight());
}});
E.extend(E.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function(F){F=F.attr("id");
if(!F){this.uuid+=1;
F=this.uuid;
}return"ui-dialog-title-"+F;
},overlay:function(F){this.$el=E.ui.dialog.overlay.create(F);
}});
E.extend(E.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:E.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(F){return F+".dialog-overlay";
}).join(" "),create:function(G){if(this.instances.length===0){setTimeout(function(){E.ui.dialog.overlay.instances.length&&E(document).bind(E.ui.dialog.overlay.events,function(H){if(E(H.target).zIndex()<E.ui.dialog.overlay.maxZ){return false;
}});
},1);
E(document).bind("keydown.dialog-overlay",function(H){if(G.options.closeOnEscape&&!H.isDefaultPrevented()&&H.keyCode&&H.keyCode===E.ui.keyCode.ESCAPE){G.close(H);
H.preventDefault();
}});
E(window).bind("resize.dialog-overlay",E.ui.dialog.overlay.resize);
}var F=(this.oldInstances.pop()||E("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});
E.fn.bgiframe&&F.bgiframe();
this.instances.push(F);
return F;
},destroy:function(G){var F=E.inArray(G,this.instances);
F!=-1&&this.oldInstances.push(this.instances.splice(F,1)[0]);
this.instances.length===0&&E([document,window]).unbind(".dialog-overlay");
G.remove();
var H=0;
E.each(this.instances,function(){H=Math.max(H,this.css("z-index"));
});
this.maxZ=H;
},height:function(){var G,F;
if(E.browser.msie&&E.browser.version<7){G=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);
F=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);
return G<F?E(window).height()+"px":G+"px";
}else{return E(document).height()+"px";
}},width:function(){var G,F;
if(E.browser.msie){G=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);
F=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);
return G<F?E(window).width()+"px":G+"px";
}else{return E(document).width()+"px";
}},resize:function(){var F=E([]);
E.each(E.ui.dialog.overlay.instances,function(){F=F.add(this);
});
F.css({width:0,height:0}).css({width:E.ui.dialog.overlay.width(),height:E.ui.dialog.overlay.height()});
}});
E.extend(E.ui.dialog.overlay.prototype,{destroy:function(){E.ui.dialog.overlay.destroy(this.$el);
}});
})(jQuery);


/* list-field.js */
Exhibit.DataEdit.Editor.ListField=function(G,E,B,F,D){this._jqThis=G;
this._itemId=E;
this._propId=B;
this._value=F;
this._divId="__DATAEDITOR__"+this._propId+"_"+Exhibit.DataEdit.Editor._getUID();
this._validators=$(G).attr("ex:validators");
this._disabledFor=Exhibit.DataEdit.Editor._parseDisabledFor($(G).attr("ex:disableFor"));
this._noEditorLens=D;
this._matchDisplayLens=Exhibit.DataEdit.Editor._parseTrueFalse($(G).attr("ex:useDisplayStyle"));
this._saveOnChange=false;
this._options=[];
this._allowNew=Exhibit.DataEdit.Editor._parseTrueFalse($(G).attr("ex:allowNew"),true);
var A=this;
$("option",this._jqThis).each(function(H){A._options.push($(this).attr("value"));
});
if(this._options.length==0){var C=database.getObject(this._itemId,"type");
this._options=Exhibit.DataEdit.Editor._uniqueObjects(C,this._propId);
}if(this._value==undefined){this._value=[];
}if(typeof (this._value)=="string"){this._value=[this._value];
}if(!(this._value instanceof Array)){throw"Invalid data for ListField";
}};
Exhibit.DataEdit.Editor.ListField.prototype.getHTML=function(F){var C=this;
F.push(function(){var G=function(J){return J.split(/,\s*/);
};
var I=function(J){return G(J).pop();
};
var H=$("#"+C._divId);
H.bind("keydown",function(J){if(J.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active){J.preventDefault();
}});
H.bind("blur",function(J){C.setValue(C.getValue());
});
H.autocomplete({minLength:0,source:function(K,J){J($.ui.autocomplete.filter(C._options,I(K.term)));
},focus:function(){return false;
},select:function(K,L){var J=G(this.value);
J.pop();
J.push(L.item.value);
J.push("");
this.value=J.join(",");
return false;
}});
if(this._saveOnChange){H.bind("change",function(J){Exhibit.DataEdit.onChange(C._itemId,C._propId);
});
}});
var E=null;
if(this._noEditorLens||this._matchDisplayLens){E=Exhibit.DataEdit.Editor._extractStyle(this._jqThis)+"border-width: 0px; width: "+$(this._jqThis).width()+"px; height: "+$(this._jqThis).height()+"px; ";
}var B="";
for(var D=0;
D<this._value.length;
D++){B=B+((B.length)?",":"")+this._value[D];
}var A=Exhibit.DataEdit.Editor._htmlTag("input",{"id":this._divId,"style":E,"class":"exhibitDataEditListField","value":B},$(this._jqThis).get()[0],true);
return A;
};
Exhibit.DataEdit.Editor.ListField.prototype.getValue=function(){var D=$("#"+this._divId).get();
var H=((D.length)?D[0].value:"");
var E=H.split(/,\s*/);
var B=[];
for(var C=0;
C<E.length;
C++){var A=E[C].match(/^ *(.*) *$/);
var F=A[1];
if(F.length>0){var G=Exhibit.DataEdit.Editor.matchExactStringFromList(F,this._options);
if(G!=null){B.push(G);
}else{if(this._allowNew){B.push(F);
}else{G=Exhibit.DataEdit.Editor.matchClosestStringFromList(F,this._options);
if(G){B.push(G);
}}}}}return B;
};
Exhibit.DataEdit.Editor.ListField.prototype.setValue=function(A){var B=$("#"+this._divId).get();
if(B.length){B[0].value=A.join(",");
}};
Exhibit.DataEdit.Editor.ListField.prototype.setError=function(A){$("#"+this._divId).css("background-color",A?Exhibit.DataEdit.Editor._ERRCOL_:Exhibit.DataEdit.Editor._BGCOL_);
};
Exhibit.DataEdit.Editor.ListField.prototype.focus=function(){};
Exhibit.DataEdit.Editor.ListField.domFilter=function(A,B){$("select",A).filter(function(C){return $(this).attr("ex:type")=="list";
}).each(B);
};


/* number-field.js */
Exhibit.DataEdit.Editor.NumberField=function(F,D,B,E,C){this._jqThis=F;
this._itemId=D;
this._propId=B;
this._value=E;
this._divId="__DATAEDITOR__"+this._propId+"_"+Exhibit.DataEdit.Editor._getUID();
this._validators=$(F).attr("ex:validators");
this._disabledFor=Exhibit.DataEdit.Editor._parseDisabledFor($(F).attr("ex:disableFor"));
this._noEditorLens=C;
this._matchDisplayLens=Exhibit.DataEdit.Editor._parseTrueFalse($(F).attr("ex:useDisplayStyle"));
this._saveOnChange=false;
this._formatDigits=parseInt($(F).attr("ex:formatDigits"));
if(this._noEditorLens&&(typeof this._value=="string")){var A=this._value;
if(A.charAt(0)=="-"){A=A.substring(1);
}if(A.charAt(0)=="0"){A=A.match(/^(\d*)/)[1];
this._formatDigits=A.length;
}}if(this._value==undefined){this._value="0";
}else{if(typeof this._value=="number"){this._value=parseInt(this._value);
}else{if((typeof this._value!="string")||(!this._value.match(/^-?[0-9]*$/))){throw"Invalid data for NumberField";
}}}};
Exhibit.DataEdit.Editor.NumberField.prototype.getHTML=function(D){var C=null;
if(this._noEditorLens||this._matchDisplayLens){C=Exhibit.DataEdit.Editor._extractStyle(this._jqThis)+"border-width: 0px; width: "+$(this._jqThis).width()+"px; height: "+$(this._jqThis).height()+"px; ";
}var B=(this._saveOnChange)?"Exhibit.DataEdit.onChange('"+this._itemId+"','"+this._propId+"')":"";
var A=Exhibit.DataEdit.Editor._htmlTag("input",{"id":this._divId,"style":C,"class":"exhibitDataEditNumberField","type":"Text","value":this._format(this._value),"onchange":B},$(this._jqThis).get()[0],true);
return A;
};
Exhibit.DataEdit.Editor.NumberField.prototype.getValue=function(){var A=$("#"+this._divId).get();
if(A.length&&(A[0].value!="")){return(!this._formatDigits)?A[0].value:this._format(A[0].value+"");
}else{return undefined;
}};
Exhibit.DataEdit.Editor.NumberField.prototype.setValue=function(A){var B=$("#"+this._divId).get();
if(B.length){B[0].value=A+"";
}};
Exhibit.DataEdit.Editor.NumberField.prototype.setError=function(A){$("#"+this._divId).css("background-color",A?Exhibit.DataEdit.Editor._ERRCOL_:Exhibit.DataEdit.Editor._BGCOL_);
};
Exhibit.DataEdit.Editor.NumberField.prototype.focus=function(){$("#"+this._divId).focus();
};
Exhibit.DataEdit.Editor.NumberField.prototype._format=function(A){A=A+"";
var B=false;
if(A.charAt(0)=="-"){B=true;
A=A.substring(1);
}while(A.length<this._formatDigits){A="0"+A;
}if(B){A="-"+A;
}return A;
};
Exhibit.DataEdit.Editor.NumberField.domFilter=function(A,B){$("input",A).filter(function(C){return $(this).attr("ex:type")=="number";
}).each(B);
};


/* text-field.js */
Exhibit.DataEdit.Editor.TextField=function(E,C,A,D,B){this._jqThis=E;
this._itemId=C;
this._propId=A;
this._value=D;
this._divId="__DATAEDITOR__"+this._propId+"_"+Exhibit.DataEdit.Editor._getUID();
this._validators=$(E).attr("ex:validators");
this._disabledFor=Exhibit.DataEdit.Editor._parseDisabledFor($(E).attr("ex:disableFor"));
this._noEditorLens=B;
this._matchDisplayLens=Exhibit.DataEdit.Editor._parseTrueFalse($(E).attr("ex:useDisplayStyle"));
this._saveOnChange=false;
this._prefDimensions=null;
this._largeText=Exhibit.DataEdit.Editor._parseTrueFalse($(E).attr("ex:large"));
this._rows=parseInt($(E).attr("ex:rows"));
this._cols=parseInt($(E).attr("ex:cols"));
if(this._value==undefined){this._value="";
}if((typeof this._value)!="string"){throw"Invalid data for TextField";
}};
Exhibit.DataEdit.Editor.TextField.prototype.getHTML=function(H){var B=Exhibit.DataEdit.Editor._getColRowDimensions(this._jqThis,1,1);
this._prefDimensions={width:B.width*5,height:B.height*1};
var E=null;
if(this._noEditorLens||this._matchDisplayLens){E=Exhibit.DataEdit.Editor._extractStyle(this._jqThis)+"border-width: 0px;  border-style: None; padding: 0px; width: "+$(this._jqThis).width()+"px; height: "+$(this._jqThis).height()+"px; ";
var D=$(this._jqThis).height();
this._largeText=((D/B.height)>=2);
}var C=(this._saveOnChange)?"Exhibit.DataEdit.onChange('"+this._itemId+"','"+this._propId+"')":"";
if(this._largeText){var G=this._cols?this._cols:null;
var F=this._rows?this._rows:null;
var A=Exhibit.DataEdit.Editor._htmlTag("textarea",{"id":this._divId,"style":E,"class":"exhibitDataEditTextAreaField","rows":F,"cols":G,"onchange":C},$(this._jqThis).get()[0],false);
return A+this._value+"</textarea>";
}else{var A=Exhibit.DataEdit.Editor._htmlTag("input",{"id":this._divId,"style":E,"class":"exhibitDataEditTextField","type":"Text","value":this._value,"onchange":C},$(this._jqThis).get()[0],true);
return A;
}};
Exhibit.DataEdit.Editor.TextField.prototype.getValue=function(){var A=$("#"+this._divId).get();
if(A.length){return(A[0].value!="")?A[0].value:undefined;
}else{return undefined;
}};
Exhibit.DataEdit.Editor.TextField.prototype.setValue=function(A){var B=$("#"+this._divId).get();
if(B.length){B[0].value=A;
}};
Exhibit.DataEdit.Editor.TextField.prototype.setError=function(A){$("#"+this._divId).css("background-color",A?Exhibit.DataEdit.Editor._ERRCOL_:Exhibit.DataEdit.Editor._BGCOL_);
};
Exhibit.DataEdit.Editor.TextField.prototype.focus=function(){$("#"+this._divId).focus();
};
Exhibit.DataEdit.Editor.TextField.domFilter=function(A,B){$("input",A).filter(function(C){return $(this).attr("ex:type")=="text";
}).each(B);
};


/* ticklist-field.js */
Exhibit.DataEdit.Editor.TickListField=function(H,F,B,G,E){this._jqThis=H;
this._itemId=F;
this._propId=B;
this._value=G;
this._divId="__DATAEDITOR__"+this._propId+"_"+Exhibit.DataEdit.Editor._getUID();
this._validators=$(H).attr("ex:validators");
this._disabledFor=Exhibit.DataEdit.Editor._parseDisabledFor($(H).attr("ex:disableFor"));
this._noEditorLens=E;
this._matchDisplayLens=Exhibit.DataEdit.Editor._parseTrueFalse($(H).attr("ex:useDisplayStyle"));
this._saveOnChange=false;
this._options=[];
this._allowNew=Exhibit.DataEdit.Editor._parseTrueFalse($(H).attr("ex:allowNew"),true);
this._width=parseInt($(H).attr("ex:width"));
this._height=parseInt($(H).attr("ex:height"));
if(this._value==undefined){this._value=[];
}if(typeof (this._value)=="string"){this._value=[this._value];
}if(!(this._value instanceof Array)){throw"Invalid data for TickListField";
}var A=this;
$("option",this._jqThis).each(function(I){A._options.push($(this).attr("value"));
});
if(this._options.length==0){var D=database.getObject(this._itemId,"type");
this._options=Exhibit.DataEdit.Editor._uniqueObjects(D,this._propId);
}for(var C=0;
C<this._value.length;
C++){if(this._options.indexOf(this._value[C])===-1){this._options.push(this._value[C]);
}}};
Exhibit.DataEdit.Editor.TickListField.prototype.getHTML=function(G){var B=this;
var D='<div class="exhibitDataEditTickListField">';
var A=(this._width)?this._width:"20em";
var F=(this._height)?this._height:"10em";
D=D+'<div id="'+this._divId+'" style="overflow:Scroll; width:'+A+"; height:"+F+';">';
for(var C=0;
C<this._options.length;
C++){var E=(this._value.indexOf(this._options[C])>=0)?' checked="checked"':"";
D=D+'<div><input type="checkbox" name="_TICKLIST_'+this._itemId+'" value="'+this._options[C]+'"'+E+" />"+this._options[C]+"</div>";
}D=D+"</div>";
if(this._allowNew){D=D+'<input id="_TICKLIST_TF_'+this._itemId+'" type="textfield" xstyle="width:'+A+';" /><a href="javascript:Exhibit.DataEdit.Editor.TickListField._add(\''+this._divId+"','_TICKLIST_TF_"+this._itemId+"','"+this._itemId+"')\">Add</a>";
}D=D+"</div>";
return D;
};
Exhibit.DataEdit.Editor.TickListField._add=function(I,F,H){var D=$("#"+F).get()[0];
if(D){var C=D.value;
if(C.length==0){return ;
}var E=0;
var G=C.toLowerCase();
var B="#"+I;
var A='input[name="_TICKLIST_'+H+'"]';
$(B+" "+A).each(function(J){var K=$(this).get()[0];
if(K.value.toLowerCase()===G){K.checked=true;
E++;
}});
if(E==0){$("#"+I).append('<div><input type="checkbox" name="_TICKLIST_'+H+'" value="'+C+'" checked="checked" />'+C+"</div>");
}}};
Exhibit.DataEdit.Editor.TickListField.prototype.getValue=function(){var C=[];
var B="#"+this._divId;
var A='input[name="_TICKLIST_'+this._itemId+'"]';
var D=$(B+" "+A).each(function(E){var F=$(this).get()[0];
if(F.checked){C.push(F.value);
}});
return C;
};
Exhibit.DataEdit.Editor.TickListField.prototype.setValue=function(A){var B=$("#"+this._divId+' input[name="_TICKLIST_'+this._itemId+'"]').each(function(C){var D=$(this).get()[0];
D.checked=(A.indexOf(D.value));
});
};
Exhibit.DataEdit.Editor.TickListField.prototype.setError=function(A){$("#"+this._divId).css("background-color",A?Exhibit.DataEdit.Editor._ERRCOL_:Exhibit.DataEdit.Editor._BGCOL_);
};
Exhibit.DataEdit.Editor.TickListField.prototype.focus=function(){};
Exhibit.DataEdit.Editor.TickListField.domFilter=function(A,B){$("select",A).filter(function(C){return $(this).attr("ex:type")=="ticklist";
}).each(B);
};
